{"version":3,"names":["cartListCss","TpElemCartListStyle0","TpElemCartList","componentWillLoad","this","getCart","response","ApiCart","cartItems","cart","total","cartTotal","watchCartItems","itemsDataPromises","forEach","cartItem","partialPromise","ApiProduct","getProductById","id","push","itemsData","Promise","all","map","product","find","quantity","cartItemKey","name","shortDescription","images","regularPrice","salePrice","stockQuantity","permalink","handlePlusminus","event","tpElemCartItem","target","closest","getAttribute","newQuantity","detail","setItemQuantity","handleUpdatedCartCount","console","log","success","cartCount","updateCart","errorMessage","cartInfo","updatedCart","emit","error","onRemoveFromCart","removeFromCart","render","items","item","save","Number","itemTotal","totalSave","h","class","href","slot","src","alt","color","currency","replace","value","min","max","fill","onClick","Host"],"sources":["src/components/elementor/ecommerce/feature/cart-list/cart-list.scss?tag=tp-elem-cart-list&encapsulation=scoped","src/components/elementor/ecommerce/feature/cart-list/cart-list.tsx"],"sourcesContent":[".cart-list {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 8px;\r\n\r\n  &__total {\r\n    display: flex;\r\n    justify-content: flex-end;\r\n    align-items: center;\r\n    gap: 8px;\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Event,\r\n  EventEmitter,\r\n  Host,\r\n  Listen,\r\n  State,\r\n  Watch,\r\n  h,\r\n} from '@stencil/core';\r\nimport { ApiCart } from '../../../../../utils/api/ecommerce/cart.api';\r\nimport { ApiProduct } from '../../../../../utils/api/ecommerce/product.api';\r\nimport {\r\n  CartInfo,\r\n  CartItem,\r\n} from '../../../../../utils/api/ecommerce/utils/interfaces/cart.interface';\r\nimport { currency } from '../../../../../utils/filters/currency.filter';\r\nimport { CartItemData } from './utils/cart-list.interface';\r\n\r\n@Component({\r\n  tag: 'tp-elem-cart-list',\r\n  styleUrl: 'cart-list.scss',\r\n  scoped: true,\r\n})\r\nexport class TpElemCartList {\r\n  /**\r\n   * Dados do carrinho.\r\n   */\r\n  @State() errorMessage: string;\r\n\r\n  /**\r\n   * Dados do carrinho.\r\n   */\r\n  @State() total: number;\r\n\r\n  /**\r\n   * Dados do carrinho.\r\n   */\r\n  @State() cartItems: CartItem[];\r\n\r\n  /**\r\n   * Dados do produto.\r\n   */\r\n  @State() itemsData: CartItemData[] = [];\r\n\r\n  /**\r\n   * Emite o updated cart.\r\n   */\r\n  @Event() updatedCart: EventEmitter<CartInfo>;\r\n\r\n  componentWillLoad() {\r\n    this.getCart();\r\n  }\r\n\r\n  async getCart() {\r\n    const response = await ApiCart.getCart();\r\n    this.cartItems = response.cart;\r\n    this.total = response.cartTotal;\r\n  }\r\n\r\n  @Watch('cartItems')\r\n  async watchCartItems() {\r\n    const itemsDataPromises = [];\r\n\r\n    this.cartItems.forEach((cartItem) => {\r\n      const partialPromise = ApiProduct.getProductById(cartItem.id);\r\n      itemsDataPromises.push(partialPromise);\r\n    });\r\n\r\n    const itemsData = await Promise.all(itemsDataPromises);\r\n\r\n    this.itemsData = itemsData.map((product) => {\r\n      const cartItem = this.cartItems.find(({ id }) => id === product.id);\r\n\r\n      return {\r\n        id: cartItem.id,\r\n        quantity: cartItem.quantity,\r\n        cartItemKey: cartItem.cartItemKey,\r\n        name: product.name,\r\n        shortDescription: product.shortDescription,\r\n        images: product.images,\r\n        regularPrice: product.regularPrice,\r\n        salePrice: product.salePrice,\r\n        stockQuantity: product.stockQuantity,\r\n        permalink: product.permalink,\r\n      };\r\n    });\r\n  }\r\n\r\n  @Listen('tpChangeAlt', { target: 'window' })\r\n  handlePlusminus(event: CustomEvent<number>) {\r\n    const tpElemCartItem = (event.target as HTMLElement).closest(\r\n      'tp-elem-cart-item',\r\n    );\r\n    const cartItemKey = tpElemCartItem.getAttribute('cart-key-item');\r\n    const newQuantity = event.detail;\r\n\r\n    this.setItemQuantity(cartItemKey, newQuantity);\r\n  }\r\n\r\n  // TODO - deletar, era só pra testar se emite o evento\r\n  @Listen('updatedCart')\r\n  handleUpdatedCartCount(event: CustomEvent<CartInfo>) {\r\n    console.log(event.detail);\r\n  }\r\n\r\n  async setItemQuantity(cartItemKey: string, quantity: number) {\r\n    try {\r\n      const { success, cart, cartTotal, cartCount } = await ApiCart.updateCart(\r\n        cartItemKey,\r\n        quantity,\r\n      );\r\n\r\n      if (success) {\r\n        this.cartItems = cart;\r\n        this.total = cartTotal;\r\n        this.errorMessage = '';\r\n\r\n        const cartInfo: CartInfo = { cart, cartTotal, cartCount };\r\n        this.updatedCart.emit(cartInfo);\r\n      } else {\r\n        this.errorMessage = 'O Carrinho não foi atualizado!';\r\n      }\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n\r\n  async onRemoveFromCart(id: number) {\r\n    try {\r\n      const { success, cart, cartTotal, cartCount } =\r\n        await ApiCart.removeFromCart(id);\r\n\r\n      if (success) {\r\n        this.cartItems = cart;\r\n        this.total = cartTotal;\r\n        this.errorMessage = '';\r\n\r\n        const cartInfo: CartInfo = { cart, cartTotal, cartCount };\r\n        this.updatedCart.emit(cartInfo);\r\n      } else {\r\n        this.errorMessage = 'O Carrinho não foi atualizado!';\r\n      }\r\n    } catch (error) {\r\n      console.log('Não foi possível remover o item do carrinho.');\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { itemsData, total, errorMessage } = this;\r\n\r\n    const items = itemsData?.map((item) => {\r\n      const {\r\n        id,\r\n        quantity,\r\n        cartItemKey,\r\n        name,\r\n        shortDescription,\r\n        images,\r\n        regularPrice,\r\n        salePrice,\r\n        stockQuantity,\r\n        permalink,\r\n      } = item;\r\n\r\n      const save = Number(regularPrice) - Number(salePrice);\r\n      const itemTotal = salePrice\r\n        ? Number(salePrice) * quantity\r\n        : Number(regularPrice) * quantity;\r\n      const totalSave = (Number(regularPrice) - Number(salePrice)) * quantity;\r\n\r\n      return (\r\n        <tp-elem-cart-item class=\"cart-list__item\" cart-key-item={cartItemKey}>\r\n          <a href={permalink} slot=\"image\">\r\n            <img src={images[0].src} alt={name} />\r\n          </a>\r\n          <ion-text tp-type=\"h20x\" slot=\"title\">\r\n            <h2>{name}</h2>\r\n          </ion-text>\r\n          {salePrice && (\r\n            <ion-text color=\"neutral-8\" tp-type=\"p16x\" slot=\"regular-price\">\r\n              <span>{currency(regularPrice, 'pt-br')}</span>\r\n            </ion-text>\r\n          )}\r\n          <ion-text color=\"neutral-8\" tp-type=\"p16xb\" slot=\"price\">\r\n            <span>\r\n              {currency(salePrice ? salePrice : regularPrice, 'pt-br')}\r\n            </span>\r\n          </ion-text>\r\n          {salePrice && (\r\n            <ion-text color=\"neutral-7\" tp-type=\"p14x\" slot=\"save\">\r\n              <span>Economize {currency(save, 'pt-br')}</span>\r\n            </ion-text>\r\n          )}\r\n          <ion-text color=\"neutral-7\" tp-type=\"p16x\" slot=\"short-description\">\r\n            <p>{shortDescription.replace('<p>', '').replace('</p>', '')}</p>\r\n          </ion-text>\r\n          <tp-plusminus\r\n            use-slot=\"false\"\r\n            value={Number(quantity)}\r\n            min={1}\r\n            max={stockQuantity ? stockQuantity : 9}\r\n            automatic-disabled\r\n            slot=\"plusminus\"\r\n          ></tp-plusminus>\r\n          <ion-button\r\n            color=\"brand\"\r\n            fill=\"clear\"\r\n            tp-no-padding\r\n            slot=\"remove\"\r\n            onClick={() => this.onRemoveFromCart(id)}\r\n          >\r\n            Remover item\r\n          </ion-button>\r\n          <ion-text color=\"neutral-8\" tp-type=\"h20x\" slot=\"item-total\">\r\n            <span>{currency(itemTotal, 'pt-br')}</span>\r\n          </ion-text>\r\n          {salePrice && (\r\n            <ion-text\r\n              class=\"cart-item__save\"\r\n              color=\"neutral-7\"\r\n              tp-type=\"p14x\"\r\n              slot=\"save-total\"\r\n            >\r\n              <span>Economize {currency(totalSave, 'pt-br')}</span>\r\n            </ion-text>\r\n          )}\r\n        </tp-elem-cart-item>\r\n      );\r\n    });\r\n\r\n    return (\r\n      <Host>\r\n        <div class=\"cart-list\">\r\n          {items}\r\n          <div class=\"cart-list__total\">\r\n            {errorMessage && (\r\n              <ion-text tp-type=\"p18xb\" color=\"warning\">\r\n                <p>{errorMessage}</p>\r\n              </ion-text>\r\n            )}\r\n            <ion-text tp-type=\"p18xb\" color=\"neutral-8\">\r\n              <h4>Total:</h4>\r\n            </ion-text>\r\n            <ion-text tp-type=\"h24x\">\r\n              <h4>{currency(total, 'pt-br')}</h4>\r\n            </ion-text>\r\n          </div>\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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"}