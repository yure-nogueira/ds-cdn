{"version":3,"names":["PRODUCT_SEARCH","DEBOUNCE_TIME","LOWER_SKIP_SEARCH_LIMIT","productSearchCss","TpElemProductSearchStyle0","TpElemProductSearch","imageSrc","display","onUpdatedSearchTerm","this","currentAbortController","abort","searchTerm","products","searching","length","AbortController","dropdownLocked","ApiProduct","getSearchedProducts","signal","error","onSearchInput","e","detail","value","onSearchFocus","onSearchBlur","searchItemHovering","onMouseEnterImage","lightboxParams","onMouseLeavesImage","Object","assign","onMouseEnterSearchbar","searchbarHovering","onMouseLeavesSearchbar","onMouseEnterSearchItem","onMouseLeavesSearchItem","getDropdownItems","color","map","name","shortDescription","images","onSale","regularPrice","price","permalink","h","href","lines","onMouseEnter","onMouseLeave","class","src","alt","replace","currency","render","searchPageUrl","maxDropdownHeight","dropdownItems","Host","key","createColorClasses","locked","style","inputMode","debounce","mode","placeholder","Boolean"],"sources":["src/components/elementor/ecommerce/feature/product-search/utils/product-search.constant.ts","src/components/elementor/ecommerce/feature/product-search/product-search.scss?tag=tp-elem-product-search&encapsulation=scoped","src/components/elementor/ecommerce/feature/product-search/product-search.tsx"],"sourcesContent":["export const PRODUCT_SEARCH = {\r\n  DEBOUNCE_TIME: 300,\r\n  LOWER_SKIP_SEARCH_LIMIT: 1,\r\n};\r\n","@import '../../../../../styles/templarios.abstracts';\r\n\r\n:host {\r\n  display: block;\r\n  position: relative;\r\n}\r\n\r\n.product-search {\r\n  &__item-wrapper {\r\n    display: flex;\r\n    flex-wrap: nowrap;\r\n    align-items: center;\r\n    width: 100%;\r\n  }\r\n\r\n  &__image-container {\r\n    flex: 0 0 auto;\r\n    width: 48px;\r\n    height: 48px;\r\n    border-radius: 4px;\r\n    margin-right: 16px;\r\n    overflow: hidden;\r\n  }\r\n\r\n  &__image {\r\n    object-fit: cover;\r\n  }\r\n\r\n  &__info {\r\n    flex: 1 1 auto;\r\n    display: flex;\r\n    gap: 16px;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n\r\n    @include breakpoint-down('xs') {\r\n      flex-direction: column;\r\n      align-items: flex-start;\r\n      gap: 4px;\r\n    }\r\n  }\r\n\r\n  &__info-left {\r\n    display: flex;\r\n    flex-direction: column;\r\n  }\r\n\r\n  &__description {\r\n    color: rgba(\r\n      var(--tp-color-contrast-rgb, var(--tp-color-neutral-10-rgb)),\r\n      0.7\r\n    );\r\n\r\n    @include breakpoint-down('sm') {\r\n      display: none;\r\n    }\r\n  }\r\n\r\n  &__info-right {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    white-space: nowrap;\r\n\r\n    @include breakpoint-down('xs') {\r\n      flex-direction: row;\r\n      gap: 8px;\r\n    }\r\n  }\r\n\r\n  &__sale-price {\r\n    text-decoration: line-through;\r\n    color: rgba(\r\n      var(--tp-color-contrast-rgb, var(--tp-color-neutral-10-rgb)),\r\n      0.7\r\n    );\r\n  }\r\n\r\n  &__loader-container {\r\n    position: absolute;\r\n    top: 9px;\r\n    left: 9px;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    background: var(--tp-color-base, var(--tp-color-neutral-2));\r\n    width: 24px;\r\n    height: 24px;\r\n  }\r\n\r\n  &__loader {\r\n    box-sizing: border-box;\r\n    width: 20px;\r\n    height: 20px;\r\n    border: 3px solid var(--tp-color-contrast, var(--tp-color-neutral-6));\r\n    border-top-color: transparent;\r\n    border-radius: 50%;\r\n    animation: product-search-spinner 1.2s linear infinite;\r\n  }\r\n\r\n  &__search-page-link {\r\n    width: 100%;\r\n    text-align: center;\r\n  }\r\n\r\n  &__lightbox {\r\n    position: absolute;\r\n    top: 24px;\r\n    right: 16px;\r\n    display: flex;\r\n    width: calc(100% - 96px);\r\n    max-width: 240px;\r\n    height: auto;\r\n    box-shadow: -4px 4px 8px 1px rgba(var(--tp-color-neutral-1-rgb), 0.8);\r\n    border-radius: 8px;\r\n    overflow: hidden;\r\n    z-index: 10000;\r\n    opacity: 0;\r\n    transition: 300ms opacity ease-in-out;\r\n\r\n    &--show {\r\n      opacity: 1;\r\n    }\r\n  }\r\n}\r\n\r\n:host(.product-search__searchbar-hover) .product-search__loader-container {\r\n  background: var(--tp-color-neutral-3);\r\n}\r\n\r\n//\r\n// animation\r\n//\r\n@keyframes product-search-spinner {\r\n  100% {\r\n    transform: rotate(360deg);\r\n  }\r\n}\r\n","import { SearchbarCustomEvent } from '@ionic/core';\r\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\r\nimport { TpColor } from '../../../../../components';\r\nimport { ApiProduct } from '../../../../../utils/api/ecommerce/product.api';\r\nimport { Product } from '../../../../../utils/api/ecommerce/utils/interfaces/product.interface';\r\nimport { currency } from '../../../../../utils/filters/currency.filter';\r\nimport { createColorClasses } from '../../../../../utils/functions/color.function';\r\nimport { PRODUCT_SEARCH } from './utils/product-search.constant';\r\n\r\n@Component({\r\n  tag: 'tp-elem-product-search',\r\n  styleUrl: 'product-search.scss',\r\n  scoped: true,\r\n})\r\nexport class TpElemProductSearch {\r\n  /**\r\n   * A variação de cor do componente.\r\n   */\r\n  @Prop({ reflect: true }) color?: TpColor;\r\n\r\n  /**\r\n   * O path da página de busca.\r\n   */\r\n  @Prop({ reflect: true }) searchPageUrl: string = '#';\r\n\r\n  /**\r\n   * A altura máxima do dropdown.\r\n   */\r\n  @Prop({ reflect: true }) maxDropdownHeight: number = 320;\r\n\r\n  /**\r\n   * O termo buscado pelo usuário.\r\n   */\r\n  @State() searchTerm: string = '';\r\n\r\n  /**\r\n   * Um conjunto de objetos com todos os dados dos produtos encontrados\r\n   * com o termo 'searchTerm'.\r\n   */\r\n  @State() products: Product[] = [];\r\n\r\n  /**\r\n   * Configurações do lightbox.\r\n   */\r\n  @State() lightboxParams: { imageSrc: string; display: boolean } = {\r\n    imageSrc: null,\r\n    display: false,\r\n  };\r\n\r\n  /**\r\n   * Se o usuário está ou não com o mouse sobre a caixa de busca.\r\n   */\r\n  @State() searchbarHovering = false;\r\n\r\n  /**\r\n   * Se o usuário está ou não com o mouse sobre a um item do dropdown.\r\n   */\r\n  @State() searchItemHovering = false;\r\n\r\n  /**\r\n   * Se o dropdown pode ou não ser mostrado.\r\n   */\r\n  @State() dropdownLocked = true;\r\n\r\n  /**\r\n   * Se uma busca está ou não sendo realizada.\r\n   */\r\n  @State() searching = false;\r\n\r\n  /**\r\n   * O abort controller da última chamada http feita pelo component.\r\n   * Caso haja uma nova requisição e a anterior não tenha sido completada,\r\n   * o abort controller permite que ela seja cancelada.\r\n   */\r\n  @State() currentAbortController: AbortController;\r\n\r\n  /**\r\n   * State e Prop watchers.\r\n   */\r\n  @Watch('searchTerm')\r\n  async onUpdatedSearchTerm() {\r\n    if (this.currentAbortController) this.currentAbortController.abort();\r\n\r\n    if (!this.searchTerm) {\r\n      this.products = [];\r\n      if (this.searching) this.searching = false;\r\n      return;\r\n    }\r\n\r\n    if (this.searchTerm.length < PRODUCT_SEARCH.LOWER_SKIP_SEARCH_LIMIT) {\r\n      if (this.searching) this.searching = false;\r\n      return;\r\n    }\r\n\r\n    this.currentAbortController = new AbortController();\r\n    this.searching = true;\r\n    this.dropdownLocked = !this.products.length;\r\n\r\n    try {\r\n      const { products } = await ApiProduct.getSearchedProducts(\r\n        this.searchTerm,\r\n        { signal: this.currentAbortController.signal },\r\n      );\r\n\r\n      if (this.searching) {\r\n        this.products = products;\r\n        this.searching = false;\r\n        this.dropdownLocked = false;\r\n      }\r\n    } catch (error) {\r\n      this.products = [];\r\n      this.searching = false;\r\n      this.dropdownLocked = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Event listeners.\r\n   */\r\n  @Listen('ionInput')\r\n  onSearchInput(e: SearchbarCustomEvent) {\r\n    const searchTerm = e.detail.value;\r\n\r\n    this.searchTerm = searchTerm;\r\n  }\r\n\r\n  @Listen('ionFocus')\r\n  onSearchFocus() {\r\n    if (this.dropdownLocked && this.products.length) {\r\n      this.dropdownLocked = false;\r\n    }\r\n  }\r\n\r\n  @Listen('ionBlur')\r\n  onSearchBlur() {\r\n    if (this.searchItemHovering && this.products.length) return;\r\n\r\n    if (!this.dropdownLocked) {\r\n      this.dropdownLocked = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Métodos internos.\r\n   */\r\n  onMouseEnterImage(imageSrc: string) {\r\n    this.lightboxParams = { imageSrc, display: true };\r\n  }\r\n\r\n  onMouseLeavesImage() {\r\n    this.lightboxParams = { ...this.lightboxParams, display: false };\r\n  }\r\n\r\n  onMouseEnterSearchbar() {\r\n    this.searchbarHovering = true;\r\n  }\r\n\r\n  onMouseLeavesSearchbar() {\r\n    this.searchbarHovering = false;\r\n  }\r\n\r\n  onMouseEnterSearchItem() {\r\n    this.searchItemHovering = true;\r\n  }\r\n\r\n  onMouseLeavesSearchItem() {\r\n    this.searchItemHovering = false;\r\n  }\r\n\r\n  getDropdownItems() {\r\n    const { color } = this;\r\n\r\n    return this.products.length\r\n      ? this.products.map(\r\n          ({\r\n            name,\r\n            shortDescription,\r\n            images,\r\n            onSale,\r\n            regularPrice,\r\n            price,\r\n            permalink,\r\n          }) => (\r\n            <ion-item\r\n              href={permalink}\r\n              lines=\"full\"\r\n              tp-spacingy=\"s08\"\r\n              color={color}\r\n              onMouseEnter={() => this.onMouseEnterSearchItem()}\r\n              onMouseLeave={() => this.onMouseLeavesSearchItem()}\r\n            >\r\n              <div class=\"product-search__item-wrapper\">\r\n                <div\r\n                  onMouseEnter={() => this.onMouseEnterImage(images[0].src)}\r\n                  onMouseLeave={() => this.onMouseLeavesImage()}\r\n                  class=\"product-search__image-container\"\r\n                >\r\n                  <img\r\n                    class=\"product-search__image\"\r\n                    src={images[0].src}\r\n                    alt=\"\"\r\n                  />\r\n                </div>\r\n\r\n                <div class=\"product-search__info\">\r\n                  <div class=\"product-search__info-left\">\r\n                    <ion-text tp-type=\"p16x\">\r\n                      <span>{name}</span>\r\n                    </ion-text>\r\n\r\n                    <ion-text\r\n                      class=\"product-search__description\"\r\n                      tp-type=\"p14x\"\r\n                    >\r\n                      <span>{shortDescription.replace(/<\\/?p>/g, '')}</span>\r\n                    </ion-text>\r\n                  </div>\r\n\r\n                  <div class=\"product-search__info-right\">\r\n                    {onSale && regularPrice && (\r\n                      <ion-text\r\n                        class=\"product-search__sale-price\"\r\n                        tp-type=\"p12x\"\r\n                      >\r\n                        {currency(regularPrice, 'pt-br')}\r\n                      </ion-text>\r\n                    )}\r\n\r\n                    <ion-text tp-type=\"p14x\">\r\n                      {currency(price, 'pt-br')}\r\n                    </ion-text>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </ion-item>\r\n          ),\r\n        )\r\n      : [];\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      color,\r\n      searchPageUrl,\r\n      maxDropdownHeight,\r\n      products,\r\n      searchTerm,\r\n      dropdownLocked,\r\n      searching,\r\n      searchbarHovering,\r\n    } = this;\r\n\r\n    const dropdownItems = this.getDropdownItems();\r\n\r\n    return (\r\n      <Host\r\n        class={createColorClasses(color, {\r\n          'product-search': true,\r\n          'product-search__searchbar-hover': !color && searchbarHovering,\r\n        })}\r\n      >\r\n        <tp-autocomplete\r\n          color={color}\r\n          locked={dropdownLocked}\r\n          style={{ '--tp-dropdown-max-height': `${maxDropdownHeight}px` }}\r\n        >\r\n          <tp-input-container class=\"product-search__searchbar\" color={color}>\r\n            <ion-searchbar\r\n              inputMode=\"search\"\r\n              debounce={PRODUCT_SEARCH.DEBOUNCE_TIME}\r\n              mode=\"md\"\r\n              search-icon=\"./../../../../assets/tp-search.svg\"\r\n              clear-icon=\"./../../../../assets/tp-x.svg\"\r\n              placeholder=\"Buscar produto\"\r\n              color={color}\r\n              onMouseEnter={() => this.onMouseEnterSearchbar()}\r\n              onMouseLeave={() => this.onMouseLeavesSearchbar()}\r\n            ></ion-searchbar>\r\n          </tp-input-container>\r\n\r\n          {searching && (\r\n            <div class=\"product-search__loader-container\">\r\n              <div class=\"product-search__loader\"></div>\r\n            </div>\r\n          )}\r\n\r\n          <tp-dropdown>\r\n            {dropdownItems}\r\n\r\n            {searchTerm && !products.length && (\r\n              <ion-item lines=\"full\" tp-spacingy=\"s08\" color={color}>\r\n                <ion-text tp-type=\"p14x\">Nenhum produto encontrado</ion-text>\r\n              </ion-item>\r\n            )}\r\n\r\n            {Boolean(products.length) && (\r\n              <ion-item\r\n                href={`${searchPageUrl}?query=${searchTerm}`}\r\n                lines=\"full\"\r\n                tp-spacingy=\"s08\"\r\n                color={color}\r\n                onMouseEnter={() => this.onMouseEnterSearchItem()}\r\n                onMouseLeave={() => this.onMouseLeavesSearchItem()}\r\n              >\r\n                <ion-text\r\n                  tp-type=\"p14x\"\r\n                  class=\"product-search__search-page-link\"\r\n                >\r\n                  Ver todos os resultados\r\n                </ion-text>\r\n              </ion-item>\r\n            )}\r\n          </tp-dropdown>\r\n        </tp-autocomplete>\r\n\r\n        <div\r\n          class={{\r\n            'product-search__lightbox': true,\r\n            'product-search__lightbox--show': this.lightboxParams.display,\r\n          }}\r\n        >\r\n          <img src={this.lightboxParams.imageSrc} alt=\"\" />\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"oJAAO,MAAMA,EAAiB,CAC5BC,cAAe,IACfC,wBAAyB,GCF3B,MAAMC,EAAmB,4gFACzB,MAAAC,EAAeD,E,MCaFE,EAAmB,M,iEASmB,I,uBAKI,I,gBAKvB,G,cAMC,G,oBAKmC,CAChEC,SAAU,KACVC,QAAS,O,uBAMkB,M,wBAKC,M,oBAKJ,K,eAKL,M,sCAarB,yBAAMC,GACJ,GAAIC,KAAKC,uBAAwBD,KAAKC,uBAAuBC,QAE7D,IAAKF,KAAKG,WAAY,CACpBH,KAAKI,SAAW,GAChB,GAAIJ,KAAKK,UAAWL,KAAKK,UAAY,MACrC,M,CAGF,GAAIL,KAAKG,WAAWG,OAASf,EAAeE,wBAAyB,CACnE,GAAIO,KAAKK,UAAWL,KAAKK,UAAY,MACrC,M,CAGFL,KAAKC,uBAAyB,IAAIM,gBAClCP,KAAKK,UAAY,KACjBL,KAAKQ,gBAAkBR,KAAKI,SAASE,OAErC,IACE,MAAMF,SAAEA,SAAmBK,EAAWC,oBACpCV,KAAKG,WACL,CAAEQ,OAAQX,KAAKC,uBAAuBU,SAGxC,GAAIX,KAAKK,UAAW,CAClBL,KAAKI,SAAWA,EAChBJ,KAAKK,UAAY,MACjBL,KAAKQ,eAAiB,K,EAExB,MAAOI,GACPZ,KAAKI,SAAW,GAChBJ,KAAKK,UAAY,MACjBL,KAAKQ,eAAiB,K,EAQ1B,aAAAK,CAAcC,GACZ,MAAMX,EAAaW,EAAEC,OAAOC,MAE5BhB,KAAKG,WAAaA,C,CAIpB,aAAAc,GACE,GAAIjB,KAAKQ,gBAAkBR,KAAKI,SAASE,OAAQ,CAC/CN,KAAKQ,eAAiB,K,EAK1B,YAAAU,GACE,GAAIlB,KAAKmB,oBAAsBnB,KAAKI,SAASE,OAAQ,OAErD,IAAKN,KAAKQ,eAAgB,CACxBR,KAAKQ,eAAiB,I,EAO1B,iBAAAY,CAAkBvB,GAChBG,KAAKqB,eAAiB,CAAExB,WAAUC,QAAS,K,CAG7C,kBAAAwB,GACEtB,KAAKqB,eAAcE,OAAAC,OAAAD,OAAAC,OAAA,GAAQxB,KAAKqB,gBAAc,CAAEvB,QAAS,O,CAG3D,qBAAA2B,GACEzB,KAAK0B,kBAAoB,I,CAG3B,sBAAAC,GACE3B,KAAK0B,kBAAoB,K,CAG3B,sBAAAE,GACE5B,KAAKmB,mBAAqB,I,CAG5B,uBAAAU,GACE7B,KAAKmB,mBAAqB,K,CAG5B,gBAAAW,GACE,MAAMC,MAAEA,GAAU/B,KAElB,OAAOA,KAAKI,SAASE,OACjBN,KAAKI,SAAS4B,KACZ,EACEC,OACAC,mBACAC,SACAC,SACAC,eACAC,QACAC,eAEAC,EAAA,YACEC,KAAMF,EACNG,MAAM,OAAM,cACA,MACZX,MAAOA,EACPY,aAAc,IAAM3C,KAAK4B,yBACzBgB,aAAc,IAAM5C,KAAK6B,2BAEzBW,EAAA,OAAKK,MAAM,gCACTL,EAAA,OACEG,aAAc,IAAM3C,KAAKoB,kBAAkBe,EAAO,GAAGW,KACrDF,aAAc,IAAM5C,KAAKsB,qBACzBuB,MAAM,mCAENL,EAAA,OACEK,MAAM,wBACNC,IAAKX,EAAO,GAAGW,IACfC,IAAI,MAIRP,EAAA,OAAKK,MAAM,wBACTL,EAAA,OAAKK,MAAM,6BACTL,EAAA,sBAAkB,QAChBA,EAAA,YAAOP,IAGTO,EAAA,YACEK,MAAM,8BAA6B,UAC3B,QAERL,EAAA,YAAON,EAAiBc,QAAQ,UAAW,OAI/CR,EAAA,OAAKK,MAAM,8BACRT,GAAUC,GACTG,EAAA,YACEK,MAAM,6BAA4B,UAC1B,QAEPI,EAASZ,EAAc,UAI5BG,EAAA,sBAAkB,QACfS,EAASX,EAAO,gBAQ/B,E,CAGN,MAAAY,GACE,MAAMnB,MACJA,EAAKoB,cACLA,EAAaC,kBACbA,EAAiBhD,SACjBA,EAAQD,WACRA,EAAUK,eACVA,EAAcH,UACdA,EAASqB,kBACTA,GACE1B,KAEJ,MAAMqD,EAAgBrD,KAAK8B,mBAE3B,OACEU,EAACc,EAAI,CAAAC,IAAA,2CACHV,MAAOW,EAAmBzB,EAAO,CAC/B,iBAAkB,KAClB,mCAAoCA,GAASL,KAG/Cc,EAAA,mBAAAe,IAAA,2CACExB,MAAOA,EACP0B,OAAQjD,EACRkD,MAAO,CAAE,2BAA4B,GAAGN,QAExCZ,EAAA,sBAAAe,IAAA,2CAAoBV,MAAM,4BAA4Bd,MAAOA,GAC3DS,EAAA,iBAAAe,IAAA,2CACEI,UAAU,SACVC,SAAUrE,EAAeC,cACzBqE,KAAK,KAAI,cACG,qCAAoC,aACrC,gCACXC,YAAY,iBACZ/B,MAAOA,EACPY,aAAc,IAAM3C,KAAKyB,wBACzBmB,aAAc,IAAM5C,KAAK2B,4BAI5BtB,GACCmC,EAAA,OAAAe,IAAA,2CAAKV,MAAM,oCACTL,EAAA,OAAAe,IAAA,2CAAKV,MAAM,4BAIfL,EAAA,eAAAe,IAAA,4CACGF,EAEAlD,IAAeC,EAASE,QACvBkC,EAAA,YAAAe,IAAA,2CAAUb,MAAM,OAAM,cAAa,MAAMX,MAAOA,GAC9CS,EAAA,YAAAe,IAAA,qDAAkB,QAAM,8BAI3BQ,QAAQ3D,EAASE,SAChBkC,EAAA,YAAAe,IAAA,2CACEd,KAAM,GAAGU,WAAuBhD,IAChCuC,MAAM,OAAM,cACA,MACZX,MAAOA,EACPY,aAAc,IAAM3C,KAAK4B,yBACzBgB,aAAc,IAAM5C,KAAK6B,2BAEzBW,EAAA,YAAAe,IAAA,qDACU,OACRV,MAAM,oCAAkC,8BASlDL,EAAA,OAAAe,IAAA,2CACEV,MAAO,CACL,2BAA4B,KAC5B,iCAAkC7C,KAAKqB,eAAevB,UAGxD0C,EAAA,OAAAe,IAAA,2CAAKT,IAAK9C,KAAKqB,eAAexB,SAAUkD,IAAI,M"}