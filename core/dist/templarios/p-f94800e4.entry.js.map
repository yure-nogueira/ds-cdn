{"version":3,"names":["productInfoCss","TpElemProductInfoStyle0","TpElemProductInfo","handleAddToCart","event","productId","quantity","detail","success","productName","cart","cartTotal","cartCount","ApiCart","addToCart","this","productInfo","Object","assign","isFeedbackSuccess","feedbackMessage","cartInfo","updatedCart","emit","error","console","handleUpdatedCartCount","log","componentWillLoad","updateProductData","product","availableCategories","Promise","all","ApiProduct","getProductById","getCategories","categoriesWithUrl","categories","map","productCategory","find","availableCategory","id","render","name","description","images","manageStock","stockStatus","stockQuantity","type","externalUrl","regularPrice","price","onSale","sku","attributes","productData","hasStock","stock","attributesList","attribute","options","h","color","join","categoriesLinks","category","url","fill","href","Host","class","slot","thumbs","length","zoom","currency","replace","target"],"sources":["src/components/elementor/ecommerce/feature/product-info/product-info.scss?tag=tp-elem-product-info&encapsulation=scoped","src/components/elementor/ecommerce/feature/product-info/product-info.tsx"],"sourcesContent":[".product-info {\r\n  &__message {\r\n    display: block;\r\n    margin-top: 24px;\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Event,\r\n  EventEmitter,\r\n  Host,\r\n  Listen,\r\n  Prop,\r\n  State,\r\n  h,\r\n} from '@stencil/core';\r\nimport { ApiCart } from '../../../../../utils/api/ecommerce/cart.api';\r\nimport { ApiProduct } from '../../../../../utils/api/ecommerce/product.api';\r\nimport { ProductCategoryWithUrl } from '../../../../../utils/api/ecommerce/utils/interfaces/product.interface';\r\nimport { currency } from '../../../../../utils/filters/currency.filter';\r\nimport { AddToCartData, ProductInfo } from './utils/product-info.interface';\r\nimport { CartInfo } from '../../../../../utils/api/ecommerce/utils/interfaces/cart.interface';\r\n\r\n@Component({\r\n  tag: 'tp-elem-product-info',\r\n  styleUrl: 'product-info.scss',\r\n  scoped: true,\r\n})\r\nexport class TpElemProductInfo {\r\n  /**\r\n   * ID do produto.\r\n   */\r\n  @Prop({ reflect: true }) productId: number;\r\n\r\n  /**\r\n   * Dados do produto à mostra.\r\n   */\r\n  @State() productInfo: ProductInfo;\r\n\r\n  /**\r\n   * Emite o evento updatedCart.\r\n   */\r\n  @Event() updatedCart: EventEmitter<CartInfo>;\r\n\r\n  categoriesWithUrl: ProductCategoryWithUrl[];\r\n\r\n  @Listen('addToCartEvent')\r\n  async handleAddToCart(event: CustomEvent<AddToCartData>) {\r\n    const { productId, quantity } = event.detail;\r\n\r\n    try {\r\n      const { success, productName, cart, cartTotal, cartCount } =\r\n        await ApiCart.addToCart(productId, quantity);\r\n      this.productInfo = { ...this.productInfo, isFeedbackSuccess: success };\r\n\r\n      if (this.productInfo.isFeedbackSuccess) {\r\n        this.productInfo = {\r\n          ...this.productInfo,\r\n          feedbackMessage: `${productName} foi adicionado ao carrinho!`,\r\n        };\r\n\r\n        const cartInfo: CartInfo = { cart, cartTotal, cartCount };\r\n        this.updatedCart.emit(cartInfo);\r\n      } else {\r\n        this.productInfo = {\r\n          ...this.productInfo,\r\n          feedbackMessage: `${productName} não foi adicionado ao carrinho!`,\r\n        };\r\n      }\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n\r\n  // TODO - deletar, era só pra testar se emite o evento\r\n  @Listen('updatedCart')\r\n  handleUpdatedCartCount(event: CustomEvent<CartInfo>) {\r\n    console.log(event.detail);\r\n  }\r\n\r\n  async componentWillLoad() {\r\n    // TODO await trava a renderização do componente, usar skeleton das partes\r\n    // e tirar o await depois pro componente ficar mais fluido\r\n    await this.updateProductData();\r\n  }\r\n\r\n  async updateProductData() {\r\n    const [product, availableCategories] = await Promise.all([\r\n      await ApiProduct.getProductById(this.productId),\r\n      await ApiProduct.getCategories(),\r\n    ]);\r\n\r\n    this.productInfo = {\r\n      ...product,\r\n      isFeedbackSuccess: false,\r\n      feedbackMessage: '',\r\n    };\r\n\r\n    this.categoriesWithUrl = product.categories.map((productCategory) =>\r\n      availableCategories.find(\r\n        (availableCategory) => availableCategory.id == productCategory.id,\r\n      ),\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { productId, categoriesWithUrl } = this;\r\n\r\n    const {\r\n      name,\r\n      description,\r\n      images,\r\n      manageStock,\r\n      stockStatus,\r\n      stockQuantity,\r\n      type,\r\n      externalUrl,\r\n      regularPrice,\r\n      price,\r\n      onSale,\r\n      sku,\r\n      categories,\r\n      attributes,\r\n      isFeedbackSuccess,\r\n      feedbackMessage,\r\n    } = this.productInfo;\r\n\r\n    const productData = {\r\n      id: productId,\r\n      stockQuantity,\r\n      stockStatus,\r\n      type,\r\n      // isFeedbackSuccess,\r\n      // feedbackMessage,\r\n    };\r\n\r\n    const hasStock =\r\n      (manageStock && stockQuantity >= 1) ||\r\n      (!manageStock && stockStatus === 'instock');\r\n    const stock =\r\n      stockQuantity == 1\r\n        ? ` (${stockQuantity} unidade)`\r\n        : ` (${stockQuantity} unidades)`;\r\n\r\n    const attributesList = attributes.map((attribute) => {\r\n      const { name, options } = attribute;\r\n\r\n      return (\r\n        <ion-text color=\"neutral-8\" tp-type=\"p14x\">\r\n          <span>\r\n            {name}: {options.join(', ')}\r\n          </span>\r\n        </ion-text>\r\n      );\r\n    });\r\n\r\n    const categoriesLinks = categoriesWithUrl.map((category) => {\r\n      const { name, url } = category;\r\n\r\n      return (\r\n        <ion-button color=\"brand\" fill=\"clear\" href={url}>\r\n          {name}\r\n        </ion-button>\r\n      );\r\n    });\r\n\r\n    return (\r\n      <Host>\r\n        <div class=\"product-info\">\r\n          <tp-elem-product-detail productData={productData}>\r\n            <tp-images-carousel\r\n              slot=\"image\"\r\n              images={images}\r\n              thumbs={images.length > 1}\r\n              zoom\r\n            ></tp-images-carousel>\r\n            <ion-text tp-type=\"h32x\" slot=\"title\">\r\n              <h2>{name}</h2>\r\n            </ion-text>\r\n\r\n            {onSale && regularPrice && (\r\n              <ion-text color=\"neutral-7\" tp-type=\"p16x\" slot=\"regular-price\">\r\n                <span>{currency(regularPrice, 'pt-br')}</span>\r\n              </ion-text>\r\n            )}\r\n\r\n            <ion-text color=\"neutral-7\" tp-type=\"p16xb\" slot=\"price\">\r\n              <span>{currency(price, 'pt-br')}</span>\r\n            </ion-text>\r\n            <ion-text color=\"neutral-8\" tp-type=\"p16x\" slot=\"description\">\r\n              <p>{description.replace('<p>', '').replace('</p>', '')}</p>\r\n            </ion-text>\r\n\r\n            <div slot=\"stock\">\r\n              <ion-text color=\"neutral-8\" tp-type=\"p14x\">\r\n                <p>\r\n                  {hasStock ? 'Produto em estoque' : 'Produto esgotado'}\r\n                  {manageStock && stock}\r\n                </p>\r\n              </ion-text>\r\n            </div>\r\n\r\n            <ion-text color=\"neutral-8\" tp-type=\"p14x\" slot=\"sku\">\r\n              <span>SKU: {sku}</span>\r\n            </ion-text>\r\n\r\n            {attributes && <div slot=\"attributes\">{attributesList}</div>}\r\n\r\n            {categories && (\r\n              <div slot=\"categories\">\r\n                <ion-text color=\"neutral-8\" tp-type=\"p14x\">\r\n                  <span>Categorias:</span>\r\n                </ion-text>\r\n                {categoriesLinks}\r\n              </div>\r\n            )}\r\n\r\n            {/* só é renderizado na tela se externalAction é true, se type === 'external' */}\r\n            <ion-button\r\n              color=\"brand\"\r\n              href={externalUrl}\r\n              target=\"_blank\"\r\n              slot=\"action\"\r\n            >\r\n              Comprar (página externa)\r\n            </ion-button>\r\n          </tp-elem-product-detail>\r\n\r\n          {feedbackMessage && (\r\n            <ion-text\r\n              class=\"product-info__message\"\r\n              color={isFeedbackSuccess ? 'success' : 'warning'}\r\n              tp-type=\"p16x\"\r\n            >\r\n              <p>{feedbackMessage}</p>\r\n            </ion-text>\r\n          )}\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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"}