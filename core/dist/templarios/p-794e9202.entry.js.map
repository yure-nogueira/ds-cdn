{"version":3,"names":["relatedProductsCss","TpElemRelatedProductsStyle0","TpElemRelatedProducts","componentWillLoad","this","getRelatedProducts","getCurrentCart","loadingProducts","relatedIds","ApiProduct","getProductById","productId","productsPromises","forEach","id","productPromise","push","products","Promise","all","cart","ApiCart","getCart","error","console","log","onAddToCart","success","addToCart","onRemoveFromCart","removeFromCart","render","productItems","h","color","length","map","product","permalink","name","regularPrice","price","stockQuantity","manageStock","stockStatus","alreadyOnCart","some","item","haveInStock","class","slot","href","currency","expand","onClick","Host"],"sources":["src/components/elementor/ecommerce/feature/related-products/related-products.scss?tag=tp-elem-related-products&encapsulation=scoped","src/components/elementor/ecommerce/feature/related-products/related-products.tsx"],"sourcesContent":["@import '../../../../../../../core/src/styles/definitions/scroll';\r\n\r\n.related-products {\r\n  display: flex;\r\n  overflow-x: auto;\r\n  gap: 16px;\r\n  padding-bottom: 16px;\r\n  @include generate-scroll-style();\r\n\r\n  &__item {\r\n    min-width: 295px;\r\n  }\r\n}\r\n","import { Component, Host, Prop, State, h } from '@stencil/core';\r\nimport { ApiCart } from '../../../../../utils/api/ecommerce/cart.api';\r\nimport { ApiProduct } from '../../../../../utils/api/ecommerce/product.api';\r\nimport { CartItem } from '../../../../../utils/api/ecommerce/utils/interfaces/cart.interface';\r\nimport { Product } from '../../../../../utils/api/ecommerce/utils/interfaces/product.interface';\r\nimport { currency } from '../../../../../utils/filters/currency.filter';\r\n\r\n@Component({\r\n  tag: 'tp-elem-related-products',\r\n  styleUrl: 'related-products.scss',\r\n  scoped: true,\r\n})\r\nexport class TpElemRelatedProducts {\r\n  /**\r\n   * ID do produto\r\n   */\r\n  @Prop({ reflect: true }) productId: number;\r\n\r\n  /**\r\n   * Items constantes no carrinho.\r\n   */\r\n  @State() cart: CartItem[] = [];\r\n\r\n  /**\r\n   * Estado de carregamento do componente.\r\n   */\r\n  @State() loadingProducts: boolean;\r\n\r\n  /**\r\n   * Um conjunto de objetos com todos os dados dos produtos à mostra.\r\n   */\r\n  @State() products: Product[];\r\n\r\n  async componentWillLoad() {\r\n    this.getRelatedProducts();\r\n    this.getCurrentCart();\r\n  }\r\n\r\n  async getRelatedProducts() {\r\n    this.loadingProducts = true;\r\n\r\n    const { relatedIds } = await ApiProduct.getProductById(this.productId);\r\n    const productsPromises: Promise<Product>[] = [];\r\n\r\n    relatedIds.forEach((id) => {\r\n      const productPromise = ApiProduct.getProductById(id);\r\n      productsPromises.push(productPromise);\r\n    });\r\n\r\n    const products = await Promise.all(productsPromises);\r\n    this.products = products;\r\n\r\n    this.loadingProducts = false;\r\n  }\r\n\r\n  async getCurrentCart() {\r\n    try {\r\n      const { cart } = await ApiCart.getCart();\r\n      this.cart = cart;\r\n    } catch (error) {\r\n      console.log('Não foi possível ter acesso ao carrinho.');\r\n    }\r\n  }\r\n\r\n  async onAddToCart(productId: number) {\r\n    try {\r\n      const { success, cart } = await ApiCart.addToCart(productId, 1);\r\n      if (success) this.cart = cart;\r\n    } catch (error) {\r\n      console.log('Não foi possível adicionar item ao carrinho.');\r\n    }\r\n  }\r\n\r\n  async onRemoveFromCart(id: number) {\r\n    try {\r\n      const { success, cart } = await ApiCart.removeFromCart(id);\r\n      if (success) this.cart = cart;\r\n    } catch (error) {\r\n      console.log('Não foi possível remover o item do carrinho.');\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { cart, loadingProducts, products } = this;\r\n\r\n    let productItems;\r\n\r\n    if (loadingProducts) {\r\n      productItems = (\r\n        <ion-text color=\"neutral-8\">\r\n          <p>Carregando...</p>\r\n        </ion-text>\r\n      );\r\n    } else {\r\n      productItems =\r\n        products && products.length > 0 ? (\r\n          products.map((product) => {\r\n            const {\r\n              permalink,\r\n              id,\r\n              name,\r\n              regularPrice,\r\n              price,\r\n              stockQuantity,\r\n              manageStock,\r\n              stockStatus,\r\n            } = product;\r\n\r\n            const alreadyOnCart = cart.some((item) => item.id === id);\r\n            const haveInStock =\r\n              (manageStock && stockQuantity >= 1) ||\r\n              (!manageStock && stockStatus === 'instock');\r\n\r\n            return (\r\n              <tp-elem-product-item\r\n                class=\"related-products__item\"\r\n                product={product}\r\n              >\r\n                <ion-text slot=\"title\" tp-type=\"p18xb\" color=\"neutral-10\">\r\n                  <h3>\r\n                    <a href={permalink}>{name}</a>\r\n                  </h3>\r\n                </ion-text>\r\n\r\n                <ion-text slot=\"regular-price\" color=\"neutral-6\" tp-type=\"p14\">\r\n                  <p>{currency(regularPrice, 'pt-br')}</p>\r\n                </ion-text>\r\n\r\n                <ion-text slot=\"price\" color=\"neutral-8\">\r\n                  <p>{currency(price, 'pt-br')}</p>\r\n                </ion-text>\r\n\r\n                {haveInStock && !alreadyOnCart && (\r\n                  <ion-button\r\n                    slot=\"button\"\r\n                    color=\"neutral-2\"\r\n                    expand=\"block\"\r\n                    onClick={() => this.onAddToCart(id)}\r\n                  >\r\n                    Adicionar ao Carrinho\r\n                  </ion-button>\r\n                )}\r\n\r\n                {haveInStock && alreadyOnCart && (\r\n                  <ion-button\r\n                    slot=\"button\"\r\n                    color=\"warning\"\r\n                    expand=\"block\"\r\n                    onClick={() => this.onRemoveFromCart(id)}\r\n                  >\r\n                    Remover do Carrinho\r\n                  </ion-button>\r\n                )}\r\n              </tp-elem-product-item>\r\n            );\r\n          })\r\n        ) : (\r\n          <ion-text color=\"neutral-8\">\r\n            <p>Não há produtos relacionados.</p>\r\n          </ion-text>\r\n        );\r\n    }\r\n\r\n    return (\r\n      <Host>\r\n        <div class=\"related-products\">{productItems}</div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"oJAAA,MAAMA,EAAqB,qsCAC3B,MAAAC,EAAeD,E,MCWFE,EAAqB,M,4DASJ,G,uDAY5B,uBAAMC,GACJC,KAAKC,qBACLD,KAAKE,gB,CAGP,wBAAMD,GACJD,KAAKG,gBAAkB,KAEvB,MAAMC,WAAEA,SAAqBC,EAAWC,eAAeN,KAAKO,WAC5D,MAAMC,EAAuC,GAE7CJ,EAAWK,SAASC,IAClB,MAAMC,EAAiBN,EAAWC,eAAeI,GACjDF,EAAiBI,KAAKD,EAAe,IAGvC,MAAME,QAAiBC,QAAQC,IAAIP,GACnCR,KAAKa,SAAWA,EAEhBb,KAAKG,gBAAkB,K,CAGzB,oBAAMD,GACJ,IACE,MAAMc,KAAEA,SAAeC,EAAQC,UAC/BlB,KAAKgB,KAAOA,C,CACZ,MAAOG,GACPC,QAAQC,IAAI,2C,EAIhB,iBAAMC,CAAYf,GAChB,IACE,MAAMgB,QAAEA,EAAOP,KAAEA,SAAeC,EAAQO,UAAUjB,EAAW,GAC7D,GAAIgB,EAASvB,KAAKgB,KAAOA,C,CACzB,MAAOG,GACPC,QAAQC,IAAI,+C,EAIhB,sBAAMI,CAAiBf,GACrB,IACE,MAAMa,QAAEA,EAAOP,KAAEA,SAAeC,EAAQS,eAAehB,GACvD,GAAIa,EAASvB,KAAKgB,KAAOA,C,CACzB,MAAOG,GACPC,QAAQC,IAAI,+C,EAIhB,MAAAM,GACE,MAAMX,KAAEA,EAAIb,gBAAEA,EAAeU,SAAEA,GAAab,KAE5C,IAAI4B,EAEJ,GAAIzB,EAAiB,CACnByB,EACEC,EAAA,YAAUC,MAAM,aACdD,EAAA,0B,KAGC,CACLD,EACEf,GAAYA,EAASkB,OAAS,EAC5BlB,EAASmB,KAAKC,IACZ,MAAMC,UACJA,EAASxB,GACTA,EAAEyB,KACFA,EAAIC,aACJA,EAAYC,MACZA,EAAKC,cACLA,EAAaC,YACbA,EAAWC,YACXA,GACEP,EAEJ,MAAMQ,EAAgBzB,EAAK0B,MAAMC,GAASA,EAAKjC,KAAOA,IACtD,MAAMkC,EACHL,GAAeD,GAAiB,IAC/BC,GAAeC,IAAgB,UAEnC,OACEX,EAAA,wBACEgB,MAAM,yBACNZ,QAASA,GAETJ,EAAA,YAAUiB,KAAK,QAAO,UAAS,QAAQhB,MAAM,cAC3CD,EAAA,UACEA,EAAA,KAAGkB,KAAMb,GAAYC,KAIzBN,EAAA,YAAUiB,KAAK,gBAAgBhB,MAAM,YAAW,UAAS,OACvDD,EAAA,SAAImB,EAASZ,EAAc,WAG7BP,EAAA,YAAUiB,KAAK,QAAQhB,MAAM,aAC3BD,EAAA,SAAImB,EAASX,EAAO,WAGrBO,IAAgBH,GACfZ,EAAA,cACEiB,KAAK,SACLhB,MAAM,YACNmB,OAAO,QACPC,QAAS,IAAMlD,KAAKsB,YAAYZ,IAAG,yBAMtCkC,GAAeH,GACdZ,EAAA,cACEiB,KAAK,SACLhB,MAAM,UACNmB,OAAO,QACPC,QAAS,IAAMlD,KAAKyB,iBAAiBf,IAAG,uBAKvB,IAI3BmB,EAAA,YAAUC,MAAM,aACdD,EAAA,0C,CAKR,OACEA,EAACsB,EAAI,KACHtB,EAAA,OAAKgB,MAAM,oBAAoBjB,G"}