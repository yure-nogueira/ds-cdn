{"file":"tp-elem-cart-list.entry.js","mappings":"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","names":[],"sources":["src/components/elementor/ecommerce/feature/cart-list/cart-list.scss?tag=tp-elem-cart-list&encapsulation=scoped","src/components/elementor/ecommerce/feature/cart-list/cart-list.tsx"],"sourcesContent":[".cart-list {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 8px;\r\n\r\n  &__total {\r\n    display: flex;\r\n    justify-content: flex-end;\r\n    align-items: center;\r\n    gap: 8px;\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Event,\r\n  EventEmitter,\r\n  Host,\r\n  Listen,\r\n  State,\r\n  Watch,\r\n  h,\r\n} from '@stencil/core';\r\nimport { ApiCart } from '../../../../../utils/api/ecommerce/cart.api';\r\nimport { ApiProduct } from '../../../../../utils/api/ecommerce/product.api';\r\nimport {\r\n  CartInfo,\r\n  CartItem,\r\n} from '../../../../../utils/api/ecommerce/utils/interfaces/cart.interface';\r\nimport { currency } from '../../../../../utils/filters/currency.filter';\r\nimport { CartItemData } from './utils/cart-list.interface';\r\n\r\n@Component({\r\n  tag: 'tp-elem-cart-list',\r\n  styleUrl: 'cart-list.scss',\r\n  scoped: true,\r\n})\r\nexport class TpElemCartList {\r\n  /**\r\n   * Dados do carrinho.\r\n   */\r\n  @State() errorMessage: string;\r\n\r\n  /**\r\n   * Dados do carrinho.\r\n   */\r\n  @State() total: number;\r\n\r\n  /**\r\n   * Dados do carrinho.\r\n   */\r\n  @State() cartItems: CartItem[];\r\n\r\n  /**\r\n   * Dados do produto.\r\n   */\r\n  @State() itemsData: CartItemData[] = [];\r\n\r\n  /**\r\n   * Emite o updated cart.\r\n   */\r\n  @Event() updatedCart: EventEmitter<CartInfo>;\r\n\r\n  componentWillLoad() {\r\n    this.getCart();\r\n  }\r\n\r\n  async getCart() {\r\n    const response = await ApiCart.getCart();\r\n    this.cartItems = response.cart;\r\n    this.total = response.cartTotal;\r\n  }\r\n\r\n  @Watch('cartItems')\r\n  async watchCartItems() {\r\n    const itemsDataPromises = [];\r\n\r\n    this.cartItems.forEach((cartItem) => {\r\n      const partialPromise = ApiProduct.getProductById(cartItem.id);\r\n      itemsDataPromises.push(partialPromise);\r\n    });\r\n\r\n    const itemsData = await Promise.all(itemsDataPromises);\r\n\r\n    this.itemsData = itemsData.map((product) => {\r\n      const cartItem = this.cartItems.find(({ id }) => id === product.id);\r\n\r\n      return {\r\n        id: cartItem.id,\r\n        quantity: cartItem.quantity,\r\n        cartItemKey: cartItem.cartItemKey,\r\n        name: product.name,\r\n        shortDescription: product.shortDescription,\r\n        images: product.images,\r\n        regularPrice: product.regularPrice,\r\n        salePrice: product.salePrice,\r\n        stockQuantity: product.stockQuantity,\r\n        permalink: product.permalink,\r\n      };\r\n    });\r\n  }\r\n\r\n  @Listen('tpChangeAlt', { target: 'window' })\r\n  handlePlusminus(event: CustomEvent<number>) {\r\n    const tpElemCartItem = (event.target as HTMLElement).closest(\r\n      'tp-elem-cart-item',\r\n    );\r\n    const cartItemKey = tpElemCartItem.getAttribute('cart-key-item');\r\n    const newQuantity = event.detail;\r\n\r\n    this.setItemQuantity(cartItemKey, newQuantity);\r\n  }\r\n\r\n  // TODO - deletar, era só pra testar se emite o evento\r\n  @Listen('updatedCart')\r\n  handleUpdatedCartCount(event: CustomEvent<CartInfo>) {\r\n    console.log(event.detail);\r\n  }\r\n\r\n  async setItemQuantity(cartItemKey: string, quantity: number) {\r\n    try {\r\n      const { success, cart, cartTotal, cartCount } = await ApiCart.updateCart(\r\n        cartItemKey,\r\n        quantity,\r\n      );\r\n\r\n      if (success) {\r\n        this.cartItems = cart;\r\n        this.total = cartTotal;\r\n        this.errorMessage = '';\r\n\r\n        const cartInfo: CartInfo = { cart, cartTotal, cartCount };\r\n        this.updatedCart.emit(cartInfo);\r\n      } else {\r\n        this.errorMessage = 'O Carrinho não foi atualizado!';\r\n      }\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n\r\n  async onRemoveFromCart(id: number) {\r\n    try {\r\n      const { success, cart, cartTotal, cartCount } =\r\n        await ApiCart.removeFromCart(id);\r\n\r\n      if (success) {\r\n        this.cartItems = cart;\r\n        this.total = cartTotal;\r\n        this.errorMessage = '';\r\n\r\n        const cartInfo: CartInfo = { cart, cartTotal, cartCount };\r\n        this.updatedCart.emit(cartInfo);\r\n      } else {\r\n        this.errorMessage = 'O Carrinho não foi atualizado!';\r\n      }\r\n    } catch (error) {\r\n      console.log('Não foi possível remover o item do carrinho.');\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { itemsData, total, errorMessage } = this;\r\n\r\n    const items = itemsData?.map((item) => {\r\n      const {\r\n        id,\r\n        quantity,\r\n        cartItemKey,\r\n        name,\r\n        shortDescription,\r\n        images,\r\n        regularPrice,\r\n        salePrice,\r\n        stockQuantity,\r\n        permalink,\r\n      } = item;\r\n\r\n      const save = Number(regularPrice) - Number(salePrice);\r\n      const itemTotal = salePrice\r\n        ? Number(salePrice) * quantity\r\n        : Number(regularPrice) * quantity;\r\n      const totalSave = (Number(regularPrice) - Number(salePrice)) * quantity;\r\n\r\n      return (\r\n        <tp-elem-cart-item class=\"cart-list__item\" cart-key-item={cartItemKey}>\r\n          <a href={permalink} slot=\"image\">\r\n            <img src={images[0].src} alt={name} />\r\n          </a>\r\n          <ion-text tp-type=\"h20x\" slot=\"title\">\r\n            <h2>{name}</h2>\r\n          </ion-text>\r\n          {salePrice && (\r\n            <ion-text color=\"neutral-8\" tp-type=\"p16x\" slot=\"regular-price\">\r\n              <span>{currency(regularPrice, 'pt-br')}</span>\r\n            </ion-text>\r\n          )}\r\n          <ion-text color=\"neutral-8\" tp-type=\"p16xb\" slot=\"price\">\r\n            <span>\r\n              {currency(salePrice ? salePrice : regularPrice, 'pt-br')}\r\n            </span>\r\n          </ion-text>\r\n          {salePrice && (\r\n            <ion-text color=\"neutral-7\" tp-type=\"p14x\" slot=\"save\">\r\n              <span>Economize {currency(save, 'pt-br')}</span>\r\n            </ion-text>\r\n          )}\r\n          <ion-text color=\"neutral-7\" tp-type=\"p16x\" slot=\"short-description\">\r\n            <p>{shortDescription.replace('<p>', '').replace('</p>', '')}</p>\r\n          </ion-text>\r\n          <tp-plusminus\r\n            use-slot=\"false\"\r\n            value={Number(quantity)}\r\n            min={1}\r\n            max={stockQuantity ? stockQuantity : 9}\r\n            automatic-disabled\r\n            slot=\"plusminus\"\r\n          ></tp-plusminus>\r\n          <ion-button\r\n            color=\"brand\"\r\n            fill=\"clear\"\r\n            tp-no-padding\r\n            slot=\"remove\"\r\n            onClick={() => this.onRemoveFromCart(id)}\r\n          >\r\n            Remover item\r\n          </ion-button>\r\n          <ion-text color=\"neutral-8\" tp-type=\"h20x\" slot=\"item-total\">\r\n            <span>{currency(itemTotal, 'pt-br')}</span>\r\n          </ion-text>\r\n          {salePrice && (\r\n            <ion-text\r\n              class=\"cart-item__save\"\r\n              color=\"neutral-7\"\r\n              tp-type=\"p14x\"\r\n              slot=\"save-total\"\r\n            >\r\n              <span>Economize {currency(totalSave, 'pt-br')}</span>\r\n            </ion-text>\r\n          )}\r\n        </tp-elem-cart-item>\r\n      );\r\n    });\r\n\r\n    return (\r\n      <Host>\r\n        <div class=\"cart-list\">\r\n          {items}\r\n          <div class=\"cart-list__total\">\r\n            {errorMessage && (\r\n              <ion-text tp-type=\"p18xb\" color=\"warning\">\r\n                <p>{errorMessage}</p>\r\n              </ion-text>\r\n            )}\r\n            <ion-text tp-type=\"p18xb\" color=\"neutral-8\">\r\n              <h4>Total:</h4>\r\n            </ion-text>\r\n            <ion-text tp-type=\"h24x\">\r\n              <h4>{currency(total, 'pt-br')}</h4>\r\n            </ion-text>\r\n          </div>\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"version":3}