{"version":3,"file":"news-list.js","sourceRoot":"","sources":["../../../../../../src/components/elementor/institucional/feature/news-list/news-list.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Host, Prop, State, Watch, h } from '@stencil/core';\r\nimport { ApiNews } from '../../../../../utils/api/institucional/news.api';\r\nimport { NEWS_LIST } from './utils/news-list.constant';\r\nimport { NewsItem } from './utils/news-list.type';\r\nimport { NewsListMode } from './utils/news-list.type';\r\n\r\n@Component({\r\n  tag: 'tp-elem-news-list',\r\n  styleUrl: 'news-list.scss',\r\n  scoped: true,\r\n  assetsDirs: ['assets'],\r\n})\r\nexport class TpElemNewsList {\r\n  /**\r\n   * Define o modo de uso do componente.\r\n   */\r\n  @Prop({ reflect: true }) mode: NewsListMode = NEWS_LIST.defaultMode;\r\n\r\n  /**\r\n   * Define a quantidade de items por página a serem carregados.\r\n   */\r\n  @Prop({ reflect: true }) perPage: number = NEWS_LIST.defaultPerPage;\r\n\r\n  /**\r\n   * Define a página atual.\r\n   */\r\n  @State() page: number = 1;\r\n\r\n  /**\r\n   * Define o total de páginas baseado nas configurações atuais.\r\n   * Configurações que impactam são: mode, perPage,\r\n   * termo de busca, categoria.\r\n   */\r\n  @State() totalPages: number;\r\n\r\n  /**\r\n   * Conjunto das notícias carregadas até o momento.\r\n   */\r\n  @State() news: NewsItem[];\r\n\r\n  /**\r\n   * Define se o compoenente está ou não carregando mais notícias.\r\n   */\r\n  @State() loading = true;\r\n\r\n  /**\r\n   * Define se o componente detectou falha de conexão com a rede.\r\n   */\r\n  @State() connectionError = false;\r\n\r\n  /**\r\n   * State and prop change listeners.\r\n   */\r\n  @Watch('page')\r\n  onLoadMore() {\r\n    this.getNews();\r\n  }\r\n\r\n  @Watch('perPage')\r\n  onPerPageChange() {\r\n    this.news = [];\r\n\r\n    if (this.page === 1) {\r\n      this.getNews();\r\n    } else {\r\n      this.page = 1;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Lifecycle hooks.\r\n   */\r\n  componentWillLoad() {\r\n    this.getNews();\r\n  }\r\n\r\n  /**\r\n   * Métodos internos\r\n   */\r\n  async getNews() {\r\n    try {\r\n      const urlParams = new URLSearchParams(window.location.search);\r\n      const extraParams = { page: this.page, perPage: this.perPage };\r\n\r\n      if (this.mode === 'search') {\r\n        const search = urlParams.get(NEWS_LIST.modeKeys.search) || '';\r\n        Object.assign(extraParams, { search });\r\n      } else if (this.mode === 'category') {\r\n        const pathSegments = location.pathname.slice(0, -1).split('/');\r\n        const category = pathSegments[pathSegments.length - 1] || '';\r\n        Object.assign(extraParams, { category });\r\n      }\r\n\r\n      this.loading = true;\r\n      const { news, totalPages } = await ApiNews.getNews(extraParams);\r\n      this.loading = false;\r\n\r\n      if (this.totalPages !== totalPages) {\r\n        this.totalPages = totalPages;\r\n      }\r\n\r\n      if (this.connectionError) {\r\n        this.connectionError = false;\r\n      }\r\n\r\n      if (!this.news) {\r\n        return (this.news = news || []);\r\n      }\r\n\r\n      this.news = [...this.news, ...news];\r\n    } catch (error) {\r\n      this.loading = false;\r\n      this.connectionError = true;\r\n    }\r\n  }\r\n\r\n  getNewsItemList() {\r\n    return this.news.map((item) => (\r\n      <li class=\"tp-news-list__item\">\r\n        <a class=\"tp-news-list__link\" href={item.permalink}>\r\n          <tp-elem-news-item>\r\n            <img\r\n              slot=\"image\"\r\n              src={item.thumb}\r\n              title={item.titleText}\r\n              alt={item.altText}\r\n            />\r\n\r\n            {item.category && (\r\n              <ion-badge slot=\"category\" color=\"brand-4\">\r\n                {item.category}\r\n              </ion-badge>\r\n            )}\r\n            <ion-text slot=\"title\">\r\n              <h1>{item.title}</h1>\r\n            </ion-text>\r\n            <ion-text slot=\"date-time\" tp-type=\"p14x\" color=\"neutral-8\">\r\n              <time>\r\n                {item.date} - {item.time}\r\n              </time>\r\n            </ion-text>\r\n          </tp-elem-news-item>\r\n        </a>\r\n      </li>\r\n    ));\r\n  }\r\n\r\n  render() {\r\n    const { perPage, page, news, totalPages, loading, connectionError } = this;\r\n\r\n    const newsItems =\r\n      !news && loading\r\n        ? Array.from({ length: perPage }).map(() => (\r\n            <ion-skeleton-text\r\n              animated\r\n              tp-component=\"tp-elem-news-item\"\r\n            ></ion-skeleton-text>\r\n          ))\r\n        : news\r\n          ? this.getNewsItemList()\r\n          : null;\r\n\r\n    return (\r\n      <Host class=\"tp-news-list\">\r\n        <ul\r\n          class={{\r\n            'tp-news-list__list': true,\r\n            'tp-news-list__list--show': Boolean(news?.length) || loading,\r\n          }}\r\n        >\r\n          {newsItems}\r\n        </ul>\r\n\r\n        <div\r\n          class={{\r\n            'tp-news-list__warning': true,\r\n            'tp-news-list__warning--show': news && !news.length,\r\n          }}\r\n        >\r\n          <ion-icon\r\n            class=\"tp-news-list__warning-icon\"\r\n            src={NEWS_LIST.icons.searchX}\r\n          ></ion-icon>\r\n\r\n          <slot name=\"not-found\"></slot>\r\n        </div>\r\n\r\n        <div\r\n          class={{\r\n            'tp-news-list__warning': true,\r\n            'tp-news-list__warning--show': connectionError,\r\n          }}\r\n        >\r\n          <ion-icon\r\n            class=\"tp-news-list__warning-icon\"\r\n            src={NEWS_LIST.icons.wifiOff}\r\n          ></ion-icon>\r\n\r\n          <slot name=\"connection-error\" />\r\n        </div>\r\n\r\n        <tp-loader\r\n          class={{\r\n            'tp-news-list__loader': true,\r\n            'tp-news-list__loader--show': news?.length && loading,\r\n          }}\r\n          size=\"auto\"\r\n        ></tp-loader>\r\n\r\n        <div\r\n          class={{\r\n            'tp-news-list__button-container': true,\r\n            'tp-news-list__button-container--show':\r\n              page !== totalPages && news && Boolean(news.length),\r\n          }}\r\n        >\r\n          <ion-button\r\n            color=\"brand-4\"\r\n            /* @ts-ignore */\r\n            size=\"sm\"\r\n            disabled={loading}\r\n            onClick={() => this.page++}\r\n          >\r\n            Carregar mais\r\n            <ion-icon slot=\"end\" src={NEWS_LIST.icons.plus}></ion-icon>\r\n          </ion-button>\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"]}