{"version":3,"file":"product-info.js","sourceRoot":"","sources":["../../../../../../src/components/elementor/ecommerce/feature/product-info/product-info.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\r\n  Component,\r\n  Event,\r\n  EventEmitter,\r\n  Host,\r\n  Listen,\r\n  Prop,\r\n  State,\r\n  h,\r\n} from '@stencil/core';\r\nimport { ApiCart } from '../../../../../utils/api/ecommerce/cart.api';\r\nimport { ApiProduct } from '../../../../../utils/api/ecommerce/product.api';\r\nimport { ProductCategoryWithUrl } from '../../../../../utils/api/ecommerce/utils/interfaces/product.interface';\r\nimport { currency } from '../../../../../utils/filters/currency.filter';\r\nimport { AddToCartData, ProductInfo } from './utils/product-info.interface';\r\nimport { CartInfo } from '../../../../../utils/api/ecommerce/utils/interfaces/cart.interface';\r\n\r\n@Component({\r\n  tag: 'tp-elem-product-info',\r\n  styleUrl: 'product-info.scss',\r\n  scoped: true,\r\n})\r\nexport class TpElemProductInfo {\r\n  /**\r\n   * ID do produto.\r\n   */\r\n  @Prop({ reflect: true }) productId: number;\r\n\r\n  /**\r\n   * Dados do produto à mostra.\r\n   */\r\n  @State() productInfo: ProductInfo;\r\n\r\n  /**\r\n   * Emite o evento updatedCart.\r\n   */\r\n  @Event() updatedCart: EventEmitter<CartInfo>;\r\n\r\n  categoriesWithUrl: ProductCategoryWithUrl[];\r\n\r\n  @Listen('addToCartEvent')\r\n  async handleAddToCart(event: CustomEvent<AddToCartData>) {\r\n    const { productId, quantity } = event.detail;\r\n\r\n    try {\r\n      const { success, productName, cart, cartTotal, cartCount } =\r\n        await ApiCart.addToCart(productId, quantity);\r\n      this.productInfo = { ...this.productInfo, isFeedbackSuccess: success };\r\n\r\n      if (this.productInfo.isFeedbackSuccess) {\r\n        this.productInfo = {\r\n          ...this.productInfo,\r\n          feedbackMessage: `${productName} foi adicionado ao carrinho!`,\r\n        };\r\n\r\n        const cartInfo: CartInfo = { cart, cartTotal, cartCount };\r\n        this.updatedCart.emit(cartInfo);\r\n      } else {\r\n        this.productInfo = {\r\n          ...this.productInfo,\r\n          feedbackMessage: `${productName} não foi adicionado ao carrinho!`,\r\n        };\r\n      }\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n\r\n  // TODO - deletar, era só pra testar se emite o evento\r\n  @Listen('updatedCart')\r\n  handleUpdatedCartCount(event: CustomEvent<CartInfo>) {\r\n    console.log(event.detail);\r\n  }\r\n\r\n  async componentWillLoad() {\r\n    // TODO await trava a renderização do componente, usar skeleton das partes\r\n    // e tirar o await depois pro componente ficar mais fluido\r\n    await this.updateProductData();\r\n  }\r\n\r\n  async updateProductData() {\r\n    const [product, availableCategories] = await Promise.all([\r\n      await ApiProduct.getProductById(this.productId),\r\n      await ApiProduct.getCategories(),\r\n    ]);\r\n\r\n    this.productInfo = {\r\n      ...product,\r\n      isFeedbackSuccess: false,\r\n      feedbackMessage: '',\r\n    };\r\n\r\n    this.categoriesWithUrl = product.categories.map((productCategory) =>\r\n      availableCategories.find(\r\n        (availableCategory) => availableCategory.id == productCategory.id,\r\n      ),\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { productId, categoriesWithUrl } = this;\r\n\r\n    const {\r\n      name,\r\n      description,\r\n      images,\r\n      manageStock,\r\n      stockStatus,\r\n      stockQuantity,\r\n      type,\r\n      externalUrl,\r\n      regularPrice,\r\n      price,\r\n      onSale,\r\n      sku,\r\n      categories,\r\n      attributes,\r\n      isFeedbackSuccess,\r\n      feedbackMessage,\r\n    } = this.productInfo;\r\n\r\n    const productData = {\r\n      id: productId,\r\n      stockQuantity,\r\n      stockStatus,\r\n      type,\r\n      // isFeedbackSuccess,\r\n      // feedbackMessage,\r\n    };\r\n\r\n    const hasStock =\r\n      (manageStock && stockQuantity >= 1) ||\r\n      (!manageStock && stockStatus === 'instock');\r\n    const stock =\r\n      stockQuantity == 1\r\n        ? ` (${stockQuantity} unidade)`\r\n        : ` (${stockQuantity} unidades)`;\r\n\r\n    const attributesList = attributes.map((attribute) => {\r\n      const { name, options } = attribute;\r\n\r\n      return (\r\n        <ion-text color=\"neutral-8\" tp-type=\"p14x\">\r\n          <span>\r\n            {name}: {options.join(', ')}\r\n          </span>\r\n        </ion-text>\r\n      );\r\n    });\r\n\r\n    const categoriesLinks = categoriesWithUrl.map((category) => {\r\n      const { name, url } = category;\r\n\r\n      return (\r\n        <ion-button color=\"brand\" fill=\"clear\" href={url}>\r\n          {name}\r\n        </ion-button>\r\n      );\r\n    });\r\n\r\n    return (\r\n      <Host>\r\n        <div class=\"product-info\">\r\n          <tp-elem-product-detail productData={productData}>\r\n            <tp-images-carousel\r\n              slot=\"image\"\r\n              images={images}\r\n              thumbs={images.length > 1}\r\n              zoom\r\n            ></tp-images-carousel>\r\n            <ion-text tp-type=\"h32x\" slot=\"title\">\r\n              <h2>{name}</h2>\r\n            </ion-text>\r\n\r\n            {onSale && regularPrice && (\r\n              <ion-text color=\"neutral-7\" tp-type=\"p16x\" slot=\"regular-price\">\r\n                <span>{currency(regularPrice, 'pt-br')}</span>\r\n              </ion-text>\r\n            )}\r\n\r\n            <ion-text color=\"neutral-7\" tp-type=\"p16xb\" slot=\"price\">\r\n              <span>{currency(price, 'pt-br')}</span>\r\n            </ion-text>\r\n            <ion-text color=\"neutral-8\" tp-type=\"p16x\" slot=\"description\">\r\n              <p>{description.replace('<p>', '').replace('</p>', '')}</p>\r\n            </ion-text>\r\n\r\n            <div slot=\"stock\">\r\n              <ion-text color=\"neutral-8\" tp-type=\"p14x\">\r\n                <p>\r\n                  {hasStock ? 'Produto em estoque' : 'Produto esgotado'}\r\n                  {manageStock && stock}\r\n                </p>\r\n              </ion-text>\r\n            </div>\r\n\r\n            <ion-text color=\"neutral-8\" tp-type=\"p14x\" slot=\"sku\">\r\n              <span>SKU: {sku}</span>\r\n            </ion-text>\r\n\r\n            {attributes && <div slot=\"attributes\">{attributesList}</div>}\r\n\r\n            {categories && (\r\n              <div slot=\"categories\">\r\n                <ion-text color=\"neutral-8\" tp-type=\"p14x\">\r\n                  <span>Categorias:</span>\r\n                </ion-text>\r\n                {categoriesLinks}\r\n              </div>\r\n            )}\r\n\r\n            {/* só é renderizado na tela se externalAction é true, se type === 'external' */}\r\n            <ion-button\r\n              color=\"brand\"\r\n              href={externalUrl}\r\n              target=\"_blank\"\r\n              slot=\"action\"\r\n            >\r\n              Comprar (página externa)\r\n            </ion-button>\r\n          </tp-elem-product-detail>\r\n\r\n          {feedbackMessage && (\r\n            <ion-text\r\n              class=\"product-info__message\"\r\n              color={isFeedbackSuccess ? 'success' : 'warning'}\r\n              tp-type=\"p16x\"\r\n            >\r\n              <p>{feedbackMessage}</p>\r\n            </ion-text>\r\n          )}\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"]}