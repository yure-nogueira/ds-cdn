{"version":3,"file":"related-products.js","sourceRoot":"","sources":["../../../../../../src/components/elementor/ecommerce/feature/related-products/related-products.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC,EAAE,MAAM,eAAe,CAAC;AAChE,OAAO,EAAE,OAAO,EAAE,MAAM,6CAA6C,CAAC;AACtE,OAAO,EAAE,UAAU,EAAE,MAAM,gDAAgD,CAAC;AAG5E,OAAO,EAAE,QAAQ,EAAE,MAAM,8CAA8C,CAAC;AAOxE,MAAM,OAAO,qBAAqB;;;oBASJ,EAAE;;;;IAY9B,KAAK,CAAC,iBAAiB;QACrB,IAAI,CAAC,kBAAkB,EAAE,CAAC;QAC1B,IAAI,CAAC,cAAc,EAAE,CAAC;IACxB,CAAC;IAED,KAAK,CAAC,kBAAkB;QACtB,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;QAE5B,MAAM,EAAE,UAAU,EAAE,GAAG,MAAM,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACvE,MAAM,gBAAgB,GAAuB,EAAE,CAAC;QAEhD,UAAU,CAAC,OAAO,CAAC,CAAC,EAAE,EAAE,EAAE;YACxB,MAAM,cAAc,GAAG,UAAU,CAAC,cAAc,CAAC,EAAE,CAAC,CAAC;YACrD,gBAAgB,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QACxC,CAAC,CAAC,CAAC;QAEH,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;QACrD,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QAEzB,IAAI,CAAC,eAAe,GAAG,KAAK,CAAC;IAC/B,CAAC;IAED,KAAK,CAAC,cAAc;QAClB,IAAI,CAAC;YACH,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,OAAO,CAAC,OAAO,EAAE,CAAC;YACzC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACnB,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,GAAG,CAAC,0CAA0C,CAAC,CAAC;QAC1D,CAAC;IACH,CAAC;IAED,KAAK,CAAC,WAAW,CAAC,SAAiB;QACjC,IAAI,CAAC;YACH,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,MAAM,OAAO,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;YAChE,IAAI,OAAO;gBAAE,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QAChC,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,GAAG,CAAC,8CAA8C,CAAC,CAAC;QAC9D,CAAC;IACH,CAAC;IAED,KAAK,CAAC,gBAAgB,CAAC,EAAU;QAC/B,IAAI,CAAC;YACH,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,MAAM,OAAO,CAAC,cAAc,CAAC,EAAE,CAAC,CAAC;YAC3D,IAAI,OAAO;gBAAE,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QAChC,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,GAAG,CAAC,8CAA8C,CAAC,CAAC;QAC9D,CAAC;IACH,CAAC;IAED,MAAM;QACJ,MAAM,EAAE,IAAI,EAAE,eAAe,EAAE,QAAQ,EAAE,GAAG,IAAI,CAAC;QAEjD,IAAI,YAAY,CAAC;QAEjB,IAAI,eAAe,EAAE,CAAC;YACpB,YAAY,GAAG,CACb,gBAAU,KAAK,EAAC,WAAW;gBACzB,6BAAoB,CACX,CACZ,CAAC;QACJ,CAAC;aAAM,CAAC;YACN,YAAY;gBACV,QAAQ,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,CAChC,QAAQ,CAAC,GAAG,CAAC,CAAC,OAAO,EAAE,EAAE;oBACvB,MAAM,EACJ,SAAS,EACT,EAAE,EACF,IAAI,EACJ,YAAY,EACZ,KAAK,EACL,aAAa,EACb,WAAW,EACX,WAAW,GACZ,GAAG,OAAO,CAAC;oBAEZ,MAAM,aAAa,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC;oBAC1D,MAAM,WAAW,GACf,CAAC,WAAW,IAAI,aAAa,IAAI,CAAC,CAAC;wBACnC,CAAC,CAAC,WAAW,IAAI,WAAW,KAAK,SAAS,CAAC,CAAC;oBAE9C,OAAO,CACL,4BACE,KAAK,EAAC,wBAAwB,EAC9B,OAAO,EAAE,OAAO;wBAEhB,gBAAU,IAAI,EAAC,OAAO,aAAS,OAAO,EAAC,KAAK,EAAC,YAAY;4BACvD;gCACE,SAAG,IAAI,EAAE,SAAS,IAAG,IAAI,CAAK,CAC3B,CACI;wBAEX,gBAAU,IAAI,EAAC,eAAe,EAAC,KAAK,EAAC,WAAW,aAAS,KAAK;4BAC5D,aAAI,QAAQ,CAAC,YAAY,EAAE,OAAO,CAAC,CAAK,CAC/B;wBAEX,gBAAU,IAAI,EAAC,OAAO,EAAC,KAAK,EAAC,WAAW;4BACtC,aAAI,QAAQ,CAAC,KAAK,EAAE,OAAO,CAAC,CAAK,CACxB;wBAEV,WAAW,IAAI,CAAC,aAAa,IAAI,CAChC,kBACE,IAAI,EAAC,QAAQ,EACb,KAAK,EAAC,WAAW,EACjB,MAAM,EAAC,OAAO,EACd,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,4BAGxB,CACd;wBAEA,WAAW,IAAI,aAAa,IAAI,CAC/B,kBACE,IAAI,EAAC,QAAQ,EACb,KAAK,EAAC,SAAS,EACf,MAAM,EAAC,OAAO,EACd,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,gBAAgB,CAAC,EAAE,CAAC,0BAG7B,CACd,CACoB,CACxB,CAAC;gBACJ,CAAC,CAAC,CACH,CAAC,CAAC,CAAC,CACF,gBAAU,KAAK,EAAC,WAAW;oBACzB,uDAAoC,CAC3B,CACZ,CAAC;QACN,CAAC;QAED,OAAO,CACL,EAAC,IAAI;YACH,WAAK,KAAK,EAAC,kBAAkB,IAAE,YAAY,CAAO,CAC7C,CACR,CAAC;IACJ,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CACF","sourcesContent":["import { Component, Host, Prop, State, h } from '@stencil/core';\r\nimport { ApiCart } from '../../../../../utils/api/ecommerce/cart.api';\r\nimport { ApiProduct } from '../../../../../utils/api/ecommerce/product.api';\r\nimport { CartItem } from '../../../../../utils/api/ecommerce/utils/interfaces/cart.interface';\r\nimport { Product } from '../../../../../utils/api/ecommerce/utils/interfaces/product.interface';\r\nimport { currency } from '../../../../../utils/filters/currency.filter';\r\n\r\n@Component({\r\n  tag: 'tp-elem-related-products',\r\n  styleUrl: 'related-products.scss',\r\n  scoped: true,\r\n})\r\nexport class TpElemRelatedProducts {\r\n  /**\r\n   * ID do produto\r\n   */\r\n  @Prop({ reflect: true }) productId: number;\r\n\r\n  /**\r\n   * Items constantes no carrinho.\r\n   */\r\n  @State() cart: CartItem[] = [];\r\n\r\n  /**\r\n   * Estado de carregamento do componente.\r\n   */\r\n  @State() loadingProducts: boolean;\r\n\r\n  /**\r\n   * Um conjunto de objetos com todos os dados dos produtos à mostra.\r\n   */\r\n  @State() products: Product[];\r\n\r\n  async componentWillLoad() {\r\n    this.getRelatedProducts();\r\n    this.getCurrentCart();\r\n  }\r\n\r\n  async getRelatedProducts() {\r\n    this.loadingProducts = true;\r\n\r\n    const { relatedIds } = await ApiProduct.getProductById(this.productId);\r\n    const productsPromises: Promise<Product>[] = [];\r\n\r\n    relatedIds.forEach((id) => {\r\n      const productPromise = ApiProduct.getProductById(id);\r\n      productsPromises.push(productPromise);\r\n    });\r\n\r\n    const products = await Promise.all(productsPromises);\r\n    this.products = products;\r\n\r\n    this.loadingProducts = false;\r\n  }\r\n\r\n  async getCurrentCart() {\r\n    try {\r\n      const { cart } = await ApiCart.getCart();\r\n      this.cart = cart;\r\n    } catch (error) {\r\n      console.log('Não foi possível ter acesso ao carrinho.');\r\n    }\r\n  }\r\n\r\n  async onAddToCart(productId: number) {\r\n    try {\r\n      const { success, cart } = await ApiCart.addToCart(productId, 1);\r\n      if (success) this.cart = cart;\r\n    } catch (error) {\r\n      console.log('Não foi possível adicionar item ao carrinho.');\r\n    }\r\n  }\r\n\r\n  async onRemoveFromCart(id: number) {\r\n    try {\r\n      const { success, cart } = await ApiCart.removeFromCart(id);\r\n      if (success) this.cart = cart;\r\n    } catch (error) {\r\n      console.log('Não foi possível remover o item do carrinho.');\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { cart, loadingProducts, products } = this;\r\n\r\n    let productItems;\r\n\r\n    if (loadingProducts) {\r\n      productItems = (\r\n        <ion-text color=\"neutral-8\">\r\n          <p>Carregando...</p>\r\n        </ion-text>\r\n      );\r\n    } else {\r\n      productItems =\r\n        products && products.length > 0 ? (\r\n          products.map((product) => {\r\n            const {\r\n              permalink,\r\n              id,\r\n              name,\r\n              regularPrice,\r\n              price,\r\n              stockQuantity,\r\n              manageStock,\r\n              stockStatus,\r\n            } = product;\r\n\r\n            const alreadyOnCart = cart.some((item) => item.id === id);\r\n            const haveInStock =\r\n              (manageStock && stockQuantity >= 1) ||\r\n              (!manageStock && stockStatus === 'instock');\r\n\r\n            return (\r\n              <tp-elem-product-item\r\n                class=\"related-products__item\"\r\n                product={product}\r\n              >\r\n                <ion-text slot=\"title\" tp-type=\"p18xb\" color=\"neutral-10\">\r\n                  <h3>\r\n                    <a href={permalink}>{name}</a>\r\n                  </h3>\r\n                </ion-text>\r\n\r\n                <ion-text slot=\"regular-price\" color=\"neutral-6\" tp-type=\"p14\">\r\n                  <p>{currency(regularPrice, 'pt-br')}</p>\r\n                </ion-text>\r\n\r\n                <ion-text slot=\"price\" color=\"neutral-8\">\r\n                  <p>{currency(price, 'pt-br')}</p>\r\n                </ion-text>\r\n\r\n                {haveInStock && !alreadyOnCart && (\r\n                  <ion-button\r\n                    slot=\"button\"\r\n                    color=\"neutral-2\"\r\n                    expand=\"block\"\r\n                    onClick={() => this.onAddToCart(id)}\r\n                  >\r\n                    Adicionar ao Carrinho\r\n                  </ion-button>\r\n                )}\r\n\r\n                {haveInStock && alreadyOnCart && (\r\n                  <ion-button\r\n                    slot=\"button\"\r\n                    color=\"warning\"\r\n                    expand=\"block\"\r\n                    onClick={() => this.onRemoveFromCart(id)}\r\n                  >\r\n                    Remover do Carrinho\r\n                  </ion-button>\r\n                )}\r\n              </tp-elem-product-item>\r\n            );\r\n          })\r\n        ) : (\r\n          <ion-text color=\"neutral-8\">\r\n            <p>Não há produtos relacionados.</p>\r\n          </ion-text>\r\n        );\r\n    }\r\n\r\n    return (\r\n      <Host>\r\n        <div class=\"related-products\">{productItems}</div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"]}