{"version":3,"file":"product-search.js","sourceRoot":"","sources":["../../../../../../src/components/elementor/ecommerce/feature/product-search/product-search.tsx"],"names":[],"mappings":"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","sourcesContent":["import { SearchbarCustomEvent } from '@ionic/core';\r\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\r\nimport { TpColor } from '../../../../../components';\r\nimport { ApiProduct } from '../../../../../utils/api/ecommerce/product.api';\r\nimport { Product } from '../../../../../utils/api/ecommerce/utils/interfaces/product.interface';\r\nimport { currency } from '../../../../../utils/filters/currency.filter';\r\nimport { createColorClasses } from '../../../../../utils/functions/color.function';\r\nimport { PRODUCT_SEARCH } from './utils/product-search.constant';\r\n\r\n@Component({\r\n  tag: 'tp-elem-product-search',\r\n  styleUrl: 'product-search.scss',\r\n  scoped: true,\r\n})\r\nexport class TpElemProductSearch {\r\n  /**\r\n   * A variação de cor do componente.\r\n   */\r\n  @Prop({ reflect: true }) color?: TpColor;\r\n\r\n  /**\r\n   * O path da página de busca.\r\n   */\r\n  @Prop({ reflect: true }) searchPageUrl: string = '#';\r\n\r\n  /**\r\n   * A altura máxima do dropdown.\r\n   */\r\n  @Prop({ reflect: true }) maxDropdownHeight: number = 320;\r\n\r\n  /**\r\n   * O termo buscado pelo usuário.\r\n   */\r\n  @State() searchTerm: string = '';\r\n\r\n  /**\r\n   * Um conjunto de objetos com todos os dados dos produtos encontrados\r\n   * com o termo 'searchTerm'.\r\n   */\r\n  @State() products: Product[] = [];\r\n\r\n  /**\r\n   * Configurações do lightbox.\r\n   */\r\n  @State() lightboxParams: { imageSrc: string; display: boolean } = {\r\n    imageSrc: null,\r\n    display: false,\r\n  };\r\n\r\n  /**\r\n   * Se o usuário está ou não com o mouse sobre a caixa de busca.\r\n   */\r\n  @State() searchbarHovering = false;\r\n\r\n  /**\r\n   * Se o usuário está ou não com o mouse sobre a um item do dropdown.\r\n   */\r\n  @State() searchItemHovering = false;\r\n\r\n  /**\r\n   * Se o dropdown pode ou não ser mostrado.\r\n   */\r\n  @State() dropdownLocked = true;\r\n\r\n  /**\r\n   * Se uma busca está ou não sendo realizada.\r\n   */\r\n  @State() searching = false;\r\n\r\n  /**\r\n   * O abort controller da última chamada http feita pelo component.\r\n   * Caso haja uma nova requisição e a anterior não tenha sido completada,\r\n   * o abort controller permite que ela seja cancelada.\r\n   */\r\n  @State() currentAbortController: AbortController;\r\n\r\n  /**\r\n   * State e Prop watchers.\r\n   */\r\n  @Watch('searchTerm')\r\n  async onUpdatedSearchTerm() {\r\n    if (this.currentAbortController) this.currentAbortController.abort();\r\n\r\n    if (!this.searchTerm) {\r\n      this.products = [];\r\n      if (this.searching) this.searching = false;\r\n      return;\r\n    }\r\n\r\n    if (this.searchTerm.length < PRODUCT_SEARCH.LOWER_SKIP_SEARCH_LIMIT) {\r\n      if (this.searching) this.searching = false;\r\n      return;\r\n    }\r\n\r\n    this.currentAbortController = new AbortController();\r\n    this.searching = true;\r\n    this.dropdownLocked = !this.products.length;\r\n\r\n    try {\r\n      const { products } = await ApiProduct.getSearchedProducts(\r\n        this.searchTerm,\r\n        { signal: this.currentAbortController.signal },\r\n      );\r\n\r\n      if (this.searching) {\r\n        this.products = products;\r\n        this.searching = false;\r\n        this.dropdownLocked = false;\r\n      }\r\n    } catch (error) {\r\n      this.products = [];\r\n      this.searching = false;\r\n      this.dropdownLocked = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Event listeners.\r\n   */\r\n  @Listen('ionInput')\r\n  onSearchInput(e: SearchbarCustomEvent) {\r\n    const searchTerm = e.detail.value;\r\n\r\n    this.searchTerm = searchTerm;\r\n  }\r\n\r\n  @Listen('ionFocus')\r\n  onSearchFocus() {\r\n    if (this.dropdownLocked && this.products.length) {\r\n      this.dropdownLocked = false;\r\n    }\r\n  }\r\n\r\n  @Listen('ionBlur')\r\n  onSearchBlur() {\r\n    if (this.searchItemHovering && this.products.length) return;\r\n\r\n    if (!this.dropdownLocked) {\r\n      this.dropdownLocked = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Métodos internos.\r\n   */\r\n  onMouseEnterImage(imageSrc: string) {\r\n    this.lightboxParams = { imageSrc, display: true };\r\n  }\r\n\r\n  onMouseLeavesImage() {\r\n    this.lightboxParams = { ...this.lightboxParams, display: false };\r\n  }\r\n\r\n  onMouseEnterSearchbar() {\r\n    this.searchbarHovering = true;\r\n  }\r\n\r\n  onMouseLeavesSearchbar() {\r\n    this.searchbarHovering = false;\r\n  }\r\n\r\n  onMouseEnterSearchItem() {\r\n    this.searchItemHovering = true;\r\n  }\r\n\r\n  onMouseLeavesSearchItem() {\r\n    this.searchItemHovering = false;\r\n  }\r\n\r\n  getDropdownItems() {\r\n    const { color } = this;\r\n\r\n    return this.products.length\r\n      ? this.products.map(\r\n          ({\r\n            name,\r\n            shortDescription,\r\n            images,\r\n            onSale,\r\n            regularPrice,\r\n            price,\r\n            permalink,\r\n          }) => (\r\n            <ion-item\r\n              href={permalink}\r\n              lines=\"full\"\r\n              tp-spacingy=\"s08\"\r\n              color={color}\r\n              onMouseEnter={() => this.onMouseEnterSearchItem()}\r\n              onMouseLeave={() => this.onMouseLeavesSearchItem()}\r\n            >\r\n              <div class=\"product-search__item-wrapper\">\r\n                <div\r\n                  onMouseEnter={() => this.onMouseEnterImage(images[0].src)}\r\n                  onMouseLeave={() => this.onMouseLeavesImage()}\r\n                  class=\"product-search__image-container\"\r\n                >\r\n                  <img\r\n                    class=\"product-search__image\"\r\n                    src={images[0].src}\r\n                    alt=\"\"\r\n                  />\r\n                </div>\r\n\r\n                <div class=\"product-search__info\">\r\n                  <div class=\"product-search__info-left\">\r\n                    <ion-text tp-type=\"p16x\">\r\n                      <span>{name}</span>\r\n                    </ion-text>\r\n\r\n                    <ion-text\r\n                      class=\"product-search__description\"\r\n                      tp-type=\"p14x\"\r\n                    >\r\n                      <span>{shortDescription.replace(/<\\/?p>/g, '')}</span>\r\n                    </ion-text>\r\n                  </div>\r\n\r\n                  <div class=\"product-search__info-right\">\r\n                    {onSale && regularPrice && (\r\n                      <ion-text\r\n                        class=\"product-search__sale-price\"\r\n                        tp-type=\"p12x\"\r\n                      >\r\n                        {currency(regularPrice, 'pt-br')}\r\n                      </ion-text>\r\n                    )}\r\n\r\n                    <ion-text tp-type=\"p14x\">\r\n                      {currency(price, 'pt-br')}\r\n                    </ion-text>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </ion-item>\r\n          ),\r\n        )\r\n      : [];\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      color,\r\n      searchPageUrl,\r\n      maxDropdownHeight,\r\n      products,\r\n      searchTerm,\r\n      dropdownLocked,\r\n      searching,\r\n      searchbarHovering,\r\n    } = this;\r\n\r\n    const dropdownItems = this.getDropdownItems();\r\n\r\n    return (\r\n      <Host\r\n        class={createColorClasses(color, {\r\n          'product-search': true,\r\n          'product-search__searchbar-hover': !color && searchbarHovering,\r\n        })}\r\n      >\r\n        <tp-autocomplete\r\n          color={color}\r\n          locked={dropdownLocked}\r\n          style={{ '--tp-dropdown-max-height': `${maxDropdownHeight}px` }}\r\n        >\r\n          <tp-input-container class=\"product-search__searchbar\" color={color}>\r\n            <ion-searchbar\r\n              inputMode=\"search\"\r\n              debounce={PRODUCT_SEARCH.DEBOUNCE_TIME}\r\n              mode=\"md\"\r\n              search-icon=\"./../../../../assets/tp-search.svg\"\r\n              clear-icon=\"./../../../../assets/tp-x.svg\"\r\n              placeholder=\"Buscar produto\"\r\n              color={color}\r\n              onMouseEnter={() => this.onMouseEnterSearchbar()}\r\n              onMouseLeave={() => this.onMouseLeavesSearchbar()}\r\n            ></ion-searchbar>\r\n          </tp-input-container>\r\n\r\n          {searching && (\r\n            <div class=\"product-search__loader-container\">\r\n              <div class=\"product-search__loader\"></div>\r\n            </div>\r\n          )}\r\n\r\n          <tp-dropdown>\r\n            {dropdownItems}\r\n\r\n            {searchTerm && !products.length && (\r\n              <ion-item lines=\"full\" tp-spacingy=\"s08\" color={color}>\r\n                <ion-text tp-type=\"p14x\">Nenhum produto encontrado</ion-text>\r\n              </ion-item>\r\n            )}\r\n\r\n            {Boolean(products.length) && (\r\n              <ion-item\r\n                href={`${searchPageUrl}?query=${searchTerm}`}\r\n                lines=\"full\"\r\n                tp-spacingy=\"s08\"\r\n                color={color}\r\n                onMouseEnter={() => this.onMouseEnterSearchItem()}\r\n                onMouseLeave={() => this.onMouseLeavesSearchItem()}\r\n              >\r\n                <ion-text\r\n                  tp-type=\"p14x\"\r\n                  class=\"product-search__search-page-link\"\r\n                >\r\n                  Ver todos os resultados\r\n                </ion-text>\r\n              </ion-item>\r\n            )}\r\n          </tp-dropdown>\r\n        </tp-autocomplete>\r\n\r\n        <div\r\n          class={{\r\n            'product-search__lightbox': true,\r\n            'product-search__lightbox--show': this.lightboxParams.display,\r\n          }}\r\n        >\r\n          <img src={this.lightboxParams.imageSrc} alt=\"\" />\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"]}