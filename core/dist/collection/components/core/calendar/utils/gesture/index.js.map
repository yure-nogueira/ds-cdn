{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../../src/components/core/calendar/utils/gesture/index.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,kBAAkB,EAAE,MAAM,sBAAsB,CAAC;AAC1D,OAAO,EAAE,mBAAmB,EAAE,MAAM,kBAAkB,CAAC;AACvD,OAAO,EAAE,mBAAmB,EAAE,MAAM,eAAe,CAAC;AAEpD,MAAM,CAAC,MAAM,aAAa,GAAG,CAAC,MAAqB,EAAW,EAAE;IAC9D,IAAI,cAAc,GAAG,KAAK,CAAC;IAC3B,IAAI,aAAa,GAAG,KAAK,CAAC;IAC1B,IAAI,aAAa,GAAG,IAAI,CAAC;IACzB,IAAI,YAAY,GAAG,KAAK,CAAC;IAEzB,MAAM,WAAW,mBACf,aAAa,EAAE,KAAK,EACpB,SAAS,EAAE,GAAG,EACd,eAAe,EAAE,CAAC,EAClB,OAAO,EAAE,IAAI,EACb,QAAQ,EAAE,EAAE,EACZ,SAAS,EAAE,EAAE,IAEV,MAAM,CACV,CAAC;IAEF,MAAM,QAAQ,GAAG,WAAW,CAAC,QAAQ,CAAC;IACtC,MAAM,WAAW,GAAG,WAAW,CAAC,WAAW,CAAC;IAC5C,MAAM,OAAO,GAAG,WAAW,CAAC,OAAO,CAAC;IACpC,MAAM,KAAK,GAAG,WAAW,CAAC,KAAK,CAAC;IAChC,MAAM,WAAW,GAAG,WAAW,CAAC,WAAW,CAAC;IAC5C,MAAM,MAAM,GAAG,WAAW,CAAC,MAAM,CAAC;IAClC,MAAM,SAAS,GAAG,WAAW,CAAC,SAAS,CAAC;IACxC,MAAM,OAAO,GAAG,WAAW,CAAC,OAAO,CAAC;IACpC,MAAM,WAAW,GAAG,WAAW,CAAC,WAAW,CAAC;IAE5C,MAAM,MAAM,GAAG;QACb,IAAI,EAAE,KAAK;QACX,MAAM,EAAE,CAAC;QACT,MAAM,EAAE,CAAC;QACT,SAAS,EAAE,CAAC;QACZ,QAAQ,EAAE,CAAC;QACX,QAAQ,EAAE,CAAC;QACX,SAAS,EAAE,CAAC;QACZ,SAAS,EAAE,CAAC;QACZ,MAAM,EAAE,CAAC;QACT,MAAM,EAAE,CAAC;QACT,WAAW,EAAE,CAAC;QACd,KAAK,EAAE,SAAgB;QACvB,IAAI,EAAE,SAAS;KAChB,CAAC;IAEF,MAAM,GAAG,GAAG,mBAAmB,CAC7B,WAAW,CAAC,SAAS,EACrB,WAAW,CAAC,SAAS,EACrB,WAAW,CAAC,QAAQ,CACrB,CAAC;IACF,MAAM,OAAO,GAAG,kBAAkB,CAAC,aAAa,CAAC;QAC/C,IAAI,EAAE,MAAM,CAAC,WAAW;QACxB,QAAQ,EAAE,MAAM,CAAC,eAAe;QAChC,aAAa,EAAE,MAAM,CAAC,aAAa;KACpC,CAAC,CAAC;IAEH,MAAM,WAAW,GAAG,CAAC,EAAW,EAAW,EAAE;QAC3C,MAAM,SAAS,GAAG,GAAG,CAAC,EAAE,CAAC,CAAC;QAC1B,IAAI,aAAa,IAAI,CAAC,aAAa,EAAE,CAAC;YACpC,OAAO,KAAK,CAAC;QACf,CAAC;QAED,YAAY,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC;QACzB,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC;QAChC,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC;QAChC,MAAM,CAAC,SAAS,GAAG,MAAM,CAAC,WAAW,GAAG,SAAS,CAAC;QAClD,MAAM,CAAC,SAAS,GAAG,MAAM,CAAC,SAAS,GAAG,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC;QACxE,MAAM,CAAC,KAAK,GAAG,EAAE,CAAC;QAElB,6BAA6B;QAC7B,IAAI,QAAQ,IAAI,QAAQ,CAAC,MAAM,CAAC,KAAK,KAAK,EAAE,CAAC;YAC3C,OAAO,KAAK,CAAC;QACf,CAAC;QACD,mBAAmB;QACnB,OAAO,CAAC,OAAO,EAAE,CAAC;QAElB,gBAAgB;QAChB,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC;YACrB,OAAO,KAAK,CAAC;QACf,CAAC;QAED,aAAa,GAAG,IAAI,CAAC;QACrB,IAAI,SAAS,KAAK,CAAC,EAAE,CAAC;YACpB,OAAO,eAAe,EAAE,CAAC;QAC3B,CAAC;QACD,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC;QACxC,OAAO,IAAI,CAAC;IACd,CAAC,CAAC;IAEF,MAAM,WAAW,GAAG,CAAC,EAAW,EAAE,EAAE;QAClC,8CAA8C;QAC9C,kDAAkD;QAClD,IAAI,cAAc,EAAE,CAAC;YACnB,IAAI,CAAC,YAAY,IAAI,aAAa,EAAE,CAAC;gBACnC,YAAY,GAAG,IAAI,CAAC;gBACpB,eAAe,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;gBAC5B,qBAAqB,CAAC,UAAU,CAAC,CAAC;YACpC,CAAC;YACD,OAAO;QACT,CAAC;QAED,sCAAsC;QACtC,eAAe,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;QAC5B,IAAI,GAAG,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,EAAE,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC;YACjD,IAAI,CAAC,GAAG,CAAC,SAAS,EAAE,IAAI,CAAC,eAAe,EAAE,EAAE,CAAC;gBAC3C,YAAY,EAAE,CAAC;YACjB,CAAC;QACH,CAAC;IACH,CAAC,CAAC;IAEF,MAAM,UAAU,GAAG,GAAG,EAAE;QACtB,oEAAoE;QACpE,sCAAsC;QACtC,IAAI,CAAC,cAAc,EAAE,CAAC;YACpB,OAAO;QACT,CAAC;QACD,YAAY,GAAG,KAAK,CAAC;QACrB,IAAI,MAAM,EAAE,CAAC;YACX,MAAM,CAAC,MAAM,CAAC,CAAC;QACjB,CAAC;IACH,CAAC,CAAC;IAEF,MAAM,eAAe,GAAG,GAAY,EAAE;QACpC,IAAI,OAAO,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC;YAClC,OAAO,KAAK,CAAC;QACf,CAAC;QACD,cAAc,GAAG,IAAI,CAAC;QACtB,aAAa,GAAG,KAAK,CAAC;QAEtB,kEAAkE;QAClE,yEAAyE;QACzE,sEAAsE;QACtE,yEAAyE;QACzE,6EAA6E;QAC7E,uCAAuC;QACvC,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC;QAChC,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC;QAChC,MAAM,CAAC,SAAS,GAAG,MAAM,CAAC,WAAW,CAAC;QAEtC,IAAI,WAAW,EAAE,CAAC;YAChB,WAAW,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QACxC,CAAC;aAAM,CAAC;YACN,WAAW,EAAE,CAAC;QAChB,CAAC;QACD,OAAO,IAAI,CAAC;IACd,CAAC,CAAC;IAEF,MAAM,iBAAiB,GAAG,GAAG,EAAE;QAC7B,8BAA8B;QAC9B,IAAI,OAAO,QAAQ,KAAK,WAAW,EAAE,CAAC;YACpC,MAAM,aAAa,GAAG,QAAQ,CAAC,aAAmC,CAAC;YACnE,IAAI,aAAa,KAAK,IAAI,IAAI,aAAa,CAAC,IAAI,EAAE,CAAC;gBACjD,aAAa,CAAC,IAAI,EAAE,CAAC;YACvB,CAAC;QACH,CAAC;IACH,CAAC,CAAC;IAEF,MAAM,WAAW,GAAG,GAAG,EAAE;QACvB,IAAI,WAAW,EAAE,CAAC;YAChB,iBAAiB,EAAE,CAAC;QACtB,CAAC;QACD,IAAI,OAAO,EAAE,CAAC;YACZ,OAAO,CAAC,MAAM,CAAC,CAAC;QAClB,CAAC;QACD,aAAa,GAAG,IAAI,CAAC;IACvB,CAAC,CAAC;IAEF,MAAM,KAAK,GAAG,GAAG,EAAE;QACjB,cAAc,GAAG,KAAK,CAAC;QACvB,aAAa,GAAG,KAAK,CAAC;QACtB,YAAY,GAAG,KAAK,CAAC;QACrB,aAAa,GAAG,IAAI,CAAC;QAErB,OAAO,CAAC,OAAO,EAAE,CAAC;IACpB,CAAC,CAAC;IAEF,gCAAgC;IAEhC,MAAM,SAAS,GAAG,CAAC,EAAuB,EAAE,EAAE;QAC5C,MAAM,cAAc,GAAG,cAAc,CAAC;QACtC,MAAM,gBAAgB,GAAG,aAAa,CAAC;QACvC,KAAK,EAAE,CAAC;QAER,IAAI,CAAC,gBAAgB,EAAE,CAAC;YACtB,OAAO;QACT,CAAC;QACD,eAAe,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;QAE5B,uBAAuB;QACvB,IAAI,cAAc,EAAE,CAAC;YACnB,IAAI,KAAK,EAAE,CAAC;gBACV,KAAK,CAAC,MAAM,CAAC,CAAC;YAChB,CAAC;YACD,OAAO;QACT,CAAC;QAED,yBAAyB;QACzB,IAAI,WAAW,EAAE,CAAC;YAChB,WAAW,CAAC,MAAM,CAAC,CAAC;QACtB,CAAC;IACH,CAAC,CAAC;IAEF,MAAM,aAAa,GAAG,mBAAmB,CACvC,WAAW,CAAC,EAAE,EACd,WAAW,EACX,WAAW,EACX,SAAS,EACT;QACE,OAAO,EAAE,KAAK;QACd,OAAO;KACR,CACF,CAAC;IAEF,MAAM,YAAY,GAAG,GAAG,EAAE;QACxB,KAAK,EAAE,CAAC;QACR,aAAa,CAAC,IAAI,EAAE,CAAC;QACrB,IAAI,WAAW,EAAE,CAAC;YAChB,WAAW,CAAC,MAAM,CAAC,CAAC;QACtB,CAAC;IACH,CAAC,CAAC;IAEF,OAAO;QACL,MAAM,CAAC,MAAM,GAAG,IAAI;YAClB,IAAI,CAAC,MAAM,EAAE,CAAC;gBACZ,IAAI,cAAc,EAAE,CAAC;oBACnB,SAAS,CAAC,SAAS,CAAC,CAAC;gBACvB,CAAC;gBAED,KAAK,EAAE,CAAC;YACV,CAAC;YACD,aAAa,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;QAC/B,CAAC;QACD,OAAO;YACL,OAAO,CAAC,OAAO,EAAE,CAAC;YAClB,aAAa,CAAC,OAAO,EAAE,CAAC;QAC1B,CAAC;KACF,CAAC;AACJ,CAAC,CAAC;AAEF,MAAM,eAAe,GAAG,CAAC,MAAqB,EAAE,EAAuB,EAAE,EAAE;IACzE,IAAI,CAAC,EAAE,EAAE,CAAC;QACR,OAAO;IACT,CAAC;IACD,MAAM,KAAK,GAAG,MAAM,CAAC,QAAQ,CAAC;IAC9B,MAAM,KAAK,GAAG,MAAM,CAAC,QAAQ,CAAC;IAC9B,MAAM,KAAK,GAAG,MAAM,CAAC,WAAW,CAAC;IAEjC,YAAY,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC;IAEzB,MAAM,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC;IACjC,MAAM,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC;IACjC,MAAM,SAAS,GAAG,CAAC,MAAM,CAAC,WAAW,GAAG,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;IACjD,MAAM,SAAS,GAAG,SAAS,GAAG,KAAK,CAAC;IACpC,IAAI,SAAS,GAAG,CAAC,IAAI,SAAS,GAAG,GAAG,EAAE,CAAC;QACrC,MAAM,SAAS,GAAG,CAAC,QAAQ,GAAG,KAAK,CAAC,GAAG,SAAS,CAAC;QACjD,MAAM,SAAS,GAAG,CAAC,QAAQ,GAAG,KAAK,CAAC,GAAG,SAAS,CAAC;QACjD,MAAM,CAAC,SAAS,GAAG,SAAS,GAAG,GAAG,GAAG,MAAM,CAAC,SAAS,GAAG,GAAG,CAAC;QAC5D,MAAM,CAAC,SAAS,GAAG,SAAS,GAAG,GAAG,GAAG,MAAM,CAAC,SAAS,GAAG,GAAG,CAAC;IAC9D,CAAC;IACD,MAAM,CAAC,MAAM,GAAG,QAAQ,GAAG,MAAM,CAAC,MAAM,CAAC;IACzC,MAAM,CAAC,MAAM,GAAG,QAAQ,GAAG,MAAM,CAAC,MAAM,CAAC;IACzC,MAAM,CAAC,KAAK,GAAG,EAAE,CAAC;AACpB,CAAC,CAAC;AAEF,MAAM,YAAY,GAAG,CAAC,EAAO,EAAE,MAAqB,EAAE,EAAE;IACtD,6CAA6C;IAC7C,0CAA0C;IAC1C,IAAI,CAAC,GAAG,CAAC,CAAC;IACV,IAAI,CAAC,GAAG,CAAC,CAAC;IACV,IAAI,EAAE,EAAE,CAAC;QACP,MAAM,cAAc,GAAG,EAAE,CAAC,cAAc,CAAC;QACzC,IAAI,cAAc,IAAI,cAAc,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YAChD,MAAM,KAAK,GAAG,cAAc,CAAC,CAAC,CAAC,CAAC;YAChC,CAAC,GAAG,KAAK,CAAC,OAAO,CAAC;YAClB,CAAC,GAAG,KAAK,CAAC,OAAO,CAAC;QACpB,CAAC;aAAM,IAAI,EAAE,CAAC,KAAK,KAAK,SAAS,EAAE,CAAC;YAClC,CAAC,GAAG,EAAE,CAAC,KAAK,CAAC;YACb,CAAC,GAAG,EAAE,CAAC,KAAK,CAAC;QACf,CAAC;IACH,CAAC;IACD,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC;IACpB,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC;AACtB,CAAC,CAAC;AAEF,MAAM,GAAG,GAAG,CAAC,EAAW,EAAE,EAAE;IAC1B,OAAO,EAAE,CAAC,SAAS,IAAI,IAAI,CAAC,GAAG,EAAE,CAAC;AACpC,CAAC,CAAC;AA6CF,OAAO,EAAE,kBAAkB,EAAE,CAAC","sourcesContent":["import { GESTURE_CONTROLLER } from './gesture-controller';\r\nimport { createPointerEvents } from './pointer-events';\r\nimport { createPanRecognizer } from './recognizers';\r\n\r\nexport const createGesture = (config: GestureConfig): Gesture => {\r\n  let hasCapturedPan = false;\r\n  let hasStartedPan = false;\r\n  let hasFiredStart = true;\r\n  let isMoveQueued = false;\r\n\r\n  const finalConfig = {\r\n    disableScroll: false,\r\n    direction: 'x',\r\n    gesturePriority: 0,\r\n    passive: true,\r\n    maxAngle: 40,\r\n    threshold: 10,\r\n\r\n    ...config,\r\n  };\r\n\r\n  const canStart = finalConfig.canStart;\r\n  const onWillStart = finalConfig.onWillStart;\r\n  const onStart = finalConfig.onStart;\r\n  const onEnd = finalConfig.onEnd;\r\n  const notCaptured = finalConfig.notCaptured;\r\n  const onMove = finalConfig.onMove;\r\n  const threshold = finalConfig.threshold;\r\n  const passive = finalConfig.passive;\r\n  const blurOnStart = finalConfig.blurOnStart;\r\n\r\n  const detail = {\r\n    type: 'pan',\r\n    startX: 0,\r\n    startY: 0,\r\n    startTime: 0,\r\n    currentX: 0,\r\n    currentY: 0,\r\n    velocityX: 0,\r\n    velocityY: 0,\r\n    deltaX: 0,\r\n    deltaY: 0,\r\n    currentTime: 0,\r\n    event: undefined as any,\r\n    data: undefined,\r\n  };\r\n\r\n  const pan = createPanRecognizer(\r\n    finalConfig.direction,\r\n    finalConfig.threshold,\r\n    finalConfig.maxAngle,\r\n  );\r\n  const gesture = GESTURE_CONTROLLER.createGesture({\r\n    name: config.gestureName,\r\n    priority: config.gesturePriority,\r\n    disableScroll: config.disableScroll,\r\n  });\r\n\r\n  const pointerDown = (ev: UIEvent): boolean => {\r\n    const timeStamp = now(ev);\r\n    if (hasStartedPan || !hasFiredStart) {\r\n      return false;\r\n    }\r\n\r\n    updateDetail(ev, detail);\r\n    detail.startX = detail.currentX;\r\n    detail.startY = detail.currentY;\r\n    detail.startTime = detail.currentTime = timeStamp;\r\n    detail.velocityX = detail.velocityY = detail.deltaX = detail.deltaY = 0;\r\n    detail.event = ev;\r\n\r\n    // Check if gesture can start\r\n    if (canStart && canStart(detail) === false) {\r\n      return false;\r\n    }\r\n    // Release fallback\r\n    gesture.release();\r\n\r\n    // Start gesture\r\n    if (!gesture.start()) {\r\n      return false;\r\n    }\r\n\r\n    hasStartedPan = true;\r\n    if (threshold === 0) {\r\n      return tryToCapturePan();\r\n    }\r\n    pan.start(detail.startX, detail.startY);\r\n    return true;\r\n  };\r\n\r\n  const pointerMove = (ev: UIEvent) => {\r\n    // fast path, if gesture is currently captured\r\n    // do minimum job to get user-land even dispatched\r\n    if (hasCapturedPan) {\r\n      if (!isMoveQueued && hasFiredStart) {\r\n        isMoveQueued = true;\r\n        calcGestureData(detail, ev);\r\n        requestAnimationFrame(fireOnMove);\r\n      }\r\n      return;\r\n    }\r\n\r\n    // gesture is currently being detected\r\n    calcGestureData(detail, ev);\r\n    if (pan.detect(detail.currentX, detail.currentY)) {\r\n      if (!pan.isGesture() || !tryToCapturePan()) {\r\n        abortGesture();\r\n      }\r\n    }\r\n  };\r\n\r\n  const fireOnMove = () => {\r\n    // Since fireOnMove is called inside a RAF, onEnd() might be called,\r\n    // we must double check hasCapturedPan\r\n    if (!hasCapturedPan) {\r\n      return;\r\n    }\r\n    isMoveQueued = false;\r\n    if (onMove) {\r\n      onMove(detail);\r\n    }\r\n  };\r\n\r\n  const tryToCapturePan = (): boolean => {\r\n    if (gesture && !gesture.capture()) {\r\n      return false;\r\n    }\r\n    hasCapturedPan = true;\r\n    hasFiredStart = false;\r\n\r\n    // reset start position since the real user-land event starts here\r\n    // If the pan detector threshold is big, not resetting the start position\r\n    // will cause a jump in the animation equal to the detector threshold.\r\n    // the array of positions used to calculate the gesture velocity does not\r\n    // need to be cleaned, more points in the positions array always results in a\r\n    // more accurate value of the velocity.\r\n    detail.startX = detail.currentX;\r\n    detail.startY = detail.currentY;\r\n    detail.startTime = detail.currentTime;\r\n\r\n    if (onWillStart) {\r\n      onWillStart(detail).then(fireOnStart);\r\n    } else {\r\n      fireOnStart();\r\n    }\r\n    return true;\r\n  };\r\n\r\n  const blurActiveElement = () => {\r\n    /* tslint:disable-next-line */\r\n    if (typeof document !== 'undefined') {\r\n      const activeElement = document.activeElement as HTMLElement | null;\r\n      if (activeElement !== null && activeElement.blur) {\r\n        activeElement.blur();\r\n      }\r\n    }\r\n  };\r\n\r\n  const fireOnStart = () => {\r\n    if (blurOnStart) {\r\n      blurActiveElement();\r\n    }\r\n    if (onStart) {\r\n      onStart(detail);\r\n    }\r\n    hasFiredStart = true;\r\n  };\r\n\r\n  const reset = () => {\r\n    hasCapturedPan = false;\r\n    hasStartedPan = false;\r\n    isMoveQueued = false;\r\n    hasFiredStart = true;\r\n\r\n    gesture.release();\r\n  };\r\n\r\n  // END *************************\r\n\r\n  const pointerUp = (ev: UIEvent | undefined) => {\r\n    const tmpHasCaptured = hasCapturedPan;\r\n    const tmpHasFiredStart = hasFiredStart;\r\n    reset();\r\n\r\n    if (!tmpHasFiredStart) {\r\n      return;\r\n    }\r\n    calcGestureData(detail, ev);\r\n\r\n    // Try to capture press\r\n    if (tmpHasCaptured) {\r\n      if (onEnd) {\r\n        onEnd(detail);\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Not captured any event\r\n    if (notCaptured) {\r\n      notCaptured(detail);\r\n    }\r\n  };\r\n\r\n  const pointerEvents = createPointerEvents(\r\n    finalConfig.el,\r\n    pointerDown,\r\n    pointerMove,\r\n    pointerUp,\r\n    {\r\n      capture: false,\r\n      passive,\r\n    },\r\n  );\r\n\r\n  const abortGesture = () => {\r\n    reset();\r\n    pointerEvents.stop();\r\n    if (notCaptured) {\r\n      notCaptured(detail);\r\n    }\r\n  };\r\n\r\n  return {\r\n    enable(enable = true) {\r\n      if (!enable) {\r\n        if (hasCapturedPan) {\r\n          pointerUp(undefined);\r\n        }\r\n\r\n        reset();\r\n      }\r\n      pointerEvents.enable(enable);\r\n    },\r\n    destroy() {\r\n      gesture.destroy();\r\n      pointerEvents.destroy();\r\n    },\r\n  };\r\n};\r\n\r\nconst calcGestureData = (detail: GestureDetail, ev: UIEvent | undefined) => {\r\n  if (!ev) {\r\n    return;\r\n  }\r\n  const prevX = detail.currentX;\r\n  const prevY = detail.currentY;\r\n  const prevT = detail.currentTime;\r\n\r\n  updateDetail(ev, detail);\r\n\r\n  const currentX = detail.currentX;\r\n  const currentY = detail.currentY;\r\n  const timestamp = (detail.currentTime = now(ev));\r\n  const timeDelta = timestamp - prevT;\r\n  if (timeDelta > 0 && timeDelta < 100) {\r\n    const velocityX = (currentX - prevX) / timeDelta;\r\n    const velocityY = (currentY - prevY) / timeDelta;\r\n    detail.velocityX = velocityX * 0.7 + detail.velocityX * 0.3;\r\n    detail.velocityY = velocityY * 0.7 + detail.velocityY * 0.3;\r\n  }\r\n  detail.deltaX = currentX - detail.startX;\r\n  detail.deltaY = currentY - detail.startY;\r\n  detail.event = ev;\r\n};\r\n\r\nconst updateDetail = (ev: any, detail: GestureDetail) => {\r\n  // get X coordinates for either a mouse click\r\n  // or a touch depending on the given event\r\n  let x = 0;\r\n  let y = 0;\r\n  if (ev) {\r\n    const changedTouches = ev.changedTouches;\r\n    if (changedTouches && changedTouches.length > 0) {\r\n      const touch = changedTouches[0];\r\n      x = touch.clientX;\r\n      y = touch.clientY;\r\n    } else if (ev.pageX !== undefined) {\r\n      x = ev.pageX;\r\n      y = ev.pageY;\r\n    }\r\n  }\r\n  detail.currentX = x;\r\n  detail.currentY = y;\r\n};\r\n\r\nconst now = (ev: UIEvent) => {\r\n  return ev.timeStamp || Date.now();\r\n};\r\n\r\nexport interface GestureDetail {\r\n  type: string;\r\n  startX: number;\r\n  startY: number;\r\n  startTime: number;\r\n  currentX: number;\r\n  currentY: number;\r\n  velocityX: number;\r\n  velocityY: number;\r\n  deltaX: number;\r\n  deltaY: number;\r\n  currentTime: number;\r\n  event: UIEvent;\r\n  data?: any;\r\n}\r\n\r\nexport type GestureCallback = (detail: GestureDetail) => boolean | void;\r\n\r\nexport interface Gesture {\r\n  enable(enable?: boolean): void;\r\n  destroy(): void;\r\n}\r\n\r\nexport interface GestureConfig {\r\n  el: Node;\r\n  disableScroll?: boolean;\r\n\r\n  direction?: 'x' | 'y';\r\n  gestureName: string;\r\n  gesturePriority?: number;\r\n  passive?: boolean;\r\n  maxAngle?: number;\r\n  threshold?: number;\r\n  blurOnStart?: boolean;\r\n\r\n  canStart?: GestureCallback;\r\n  onWillStart?: (_: GestureDetail) => Promise<void>;\r\n  onStart?: GestureCallback;\r\n  onMove?: GestureCallback;\r\n  onEnd?: GestureCallback;\r\n  notCaptured?: GestureCallback;\r\n}\r\n\r\nexport { GESTURE_CONTROLLER };\r\n"]}